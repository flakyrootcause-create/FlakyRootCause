{
  "id": 35,
  "repo": "pytorch",
  "issue_url": "https://github.com/pytorch/pytorch/pull/154856",
  "pr_url": "https://github.com/pytorch/pytorch/pull/154856",
  "issue_description": "[PR Linked Issue]\nPlatforms: linux\n\n  This test was disabled because it is failing in CI. See [recent examples](https://hud.pytorch.org/flakytest?name=test_grad_with_manual_interleaved_ScheduleClass0_use_new_runtime_True&suite=ScheduleTest&limit=100) and the most recent trunk [workflow logs](https://github.com/pytorch/pytorch/runs/42919034022).\n\n  Over the past 3 hours, it has been determined flaky in 7 workflow(s) with 7 failures and 7 successes.\n\n  **Debugging instructions (after clicking on the recent samples link):**\n  DO NOT ASSUME THINGS ARE OKAY IF THE CI IS GREEN. We now shield flaky tests from developers so CI will thus be green but it will be harder to parse the logs.\n  To find relevant log snippets:\n  1. Click on the workflow logs linked above\n  2. Click on the Test step of the job so that it is expanded. Otherwise, the grepping will not work.\n  3. Grep for `test_grad_with_manual_interleaved_ScheduleClass0_use_new_runtime_True`\n  4. There should be several instances run (as flaky tests are rerun in CI) from which you can study the logs.\n  \n  \n\n<details><summary>Sample error message</summary>\n\n```\nTraceback (most recent call last):\n  File \"/opt/conda/envs/py_3.10/lib/python3.10/site-packages/torch/testing/_internal/common_distributed.py\", line 1721, in wrapper\n    raise rv\nAssertionError: Tensor-likes are not close!\n\nMismatched elements: 158 / 512 (30.9%)\nGreatest absolute difference: 0.0002696812152862549 at index (331,) (up to 4e-05 allowed)\nGreatest relative difference: 0.09954891353845596 at index (176,) (up to 1e-05 allowed)\n\nTo execute this test, run the following from the base repo dir:\n    python test/distributed/pipelining/test_schedule_multiproc.py ScheduleTest.test_grad_with_manual_interleaved_ScheduleClass0_use_new_runtime_True\n\nThis message can be suppressed by setting PYTORCH_PRINT_REPRO_ON_FAILURE=0\n```\n\n</details>\n\n\n  Test file path: `distributed/pipelining/test_schedule_multiproc.py`\n\n  For all disabled tests (by GitHub issue), see https://hud.pytorch.org/disabled.\n\ncc @H-Huang @awgu @wanchaol @fegin @fduwjj @wz337 @wconstab @d4l3k @clee2000",
  "files_changed": [
    {
      "filename": "test/distributed/pipelining/test_schedule_multiproc.py",
      "status": "modified",
      "patch": "@@ -513,7 +513,7 @@ def test_grad_with_manual_interleaved(self, ScheduleClass, use_new_runtime):\n             for name, p in stage_module.named_parameters():\n                 ref_p = ref_submod.get_parameter(name)\n                 try:\n-                    torch.testing.assert_close(p.grad, ref_p.grad, rtol=1e-5, atol=4e-5)\n+                    torch.testing.assert_close(p.grad, ref_p.grad, rtol=1e-5, atol=1e-3)\n                 except AssertionError:\n                     print(f\"Gradient test failed for {name}: {p.grad} vs {ref_p.grad}\")\n                     raise"
    }
  ],
  "fix_category": "Change assertion",
  "root_cause_category": "Floating point operations",
  "root_cause_subcategory": NaN
}