{
  "id": 387,
  "repo": "django",
  "issue_url": "https://github.com/django/django/pull/19437",
  "pr_url": "https://github.com/django/django/pull/19437",
  "issue_description": "#### Trac ticket number\r\n\r\nN/A\r\n\r\n#### Branch description\r\n\r\nTwo separate calls to look up access time can result in sub-second differences which cause the test to fail.\r\n\r\nWhen running the full test suite locally, this is consistently failing for me.\r\n\r\n#### Checklist\r\n\r\n- [x] This PR targets the `main` branch. <!-- Backports will be evaluated and done by mergers, when necessary. -->\r\n- [x] The commit message is written in past tense, mentions the ticket number, and ends with a period.\r\n- [ ] I have checked the \"Has patch\" ticket flag in the Trac system.\r\n- [x] I have added or updated relevant tests.\r\n- [ ] I have added or updated relevant docs, including release notes if applicable.\r\n- [ ] I have attached screenshots in both light and dark modes for any UI changes.",
  "files_changed": [
    {
      "filename": "tests/file_storage/tests.py",
      "status": "modified",
      "patch": "@@ -186,17 +186,19 @@ def test_file_get_accessed_time(self):\n         f = ContentFile(\"custom contents\")\n         f_name = self.storage.save(\"test.file\", f)\n         self.addCleanup(self.storage.delete, f_name)\n+\n+        path = self.storage.path(f_name)\n         atime = self.storage.get_accessed_time(f_name)\n \n-        self.assertEqual(\n+        self.assertAlmostEqual(\n             atime,\n-            datetime.datetime.fromtimestamp(\n-                os.path.getatime(self.storage.path(f_name))\n-            ),\n+            datetime.datetime.fromtimestamp(os.path.getatime(path)),\n+            delta=datetime.timedelta(seconds=1),\n         )\n-        self.assertLess(\n-            timezone.now() - self.storage.get_accessed_time(f_name),\n-            datetime.timedelta(seconds=2),\n+        self.assertAlmostEqual(\n+            atime,\n+            timezone.now(),\n+            delta=datetime.timedelta(seconds=1),\n         )\n \n     @requires_tz_support\n@@ -212,17 +214,19 @@ def test_file_get_created_time(self):\n         f = ContentFile(\"custom contents\")\n         f_name = self.storage.save(\"test.file\", f)\n         self.addCleanup(self.storage.delete, f_name)\n+\n+        path = self.storage.path(f_name)\n         ctime = self.storage.get_created_time(f_name)\n \n-        self.assertEqual(\n+        self.assertAlmostEqual(\n             ctime,\n-            datetime.datetime.fromtimestamp(\n-                os.path.getctime(self.storage.path(f_name))\n-            ),\n+            datetime.datetime.fromtimestamp(os.path.getctime(path)),\n+            delta=datetime.timedelta(seconds=1),\n         )\n-        self.assertLess(\n-            timezone.now() - self.storage.get_created_time(f_name),\n-            datetime.timedelta(seconds=2),\n+        self.assertAlmostEqual(\n+            ctime,\n+            timezone.now(),\n+            delta=datetime.timedelta(seconds=1),\n         )\n \n     @requires_tz_support\n@@ -238,17 +242,19 @@ def test_file_get_modified_time(self):\n         f = ContentFile(\"custom contents\")\n         f_name = self.storage.save(\"test.file\", f)\n         self.addCleanup(self.storage.delete, f_name)\n+\n+        path = self.storage.path(f_name)\n         mtime = self.storage.get_modified_time(f_name)\n \n-        self.assertEqual(\n+        self.assertAlmostEqual(\n             mtime,\n-            datetime.datetime.fromtimestamp(\n-                os.path.getmtime(self.storage.path(f_name))\n-            ),\n+            datetime.datetime.fromtimestamp(os.path.getmtime(path)),\n+            delta=datetime.timedelta(seconds=1),\n         )\n-        self.assertLess(\n-            timezone.now() - self.storage.get_modified_time(f_name),\n-            datetime.timedelta(seconds=2),\n+        self.assertAlmostEqual(\n+            mtime,\n+            timezone.now(),\n+            delta=datetime.timedelta(seconds=1),\n         )\n \n     @requires_tz_support"
    }
  ],
  "fix_category": "Change assertion",
  "root_cause_category": "Time",
  "root_cause_subcategory": NaN
}