{
  "id": 74,
  "repo": "vscode",
  "issue_url": "https://github.com/microsoft/vscode/pull/238364",
  "pr_url": "https://github.com/microsoft/vscode/pull/238364",
  "issue_description": "[PR Linked Issue]\nhttps://dev.azure.com/monacotools/Monaco/_build/results?buildId=314193&view=logs&j=9833cdaa-2e92-5f8d-56a8-239fd18fd628&t=efbaf268-cf98-50c2-bb3c-7950770fd6bc&l=749\n\n```\n  1) vscode API - terminal\n       Terminal\n         environmentVariableCollection\n           should have collection variables apply to terminals immediately after setting:\n     Error: Timeout: b1~b2~ should be printed after 20 seconds.\nDid not pass accept function\n      at poll (/Users/runner/work/1/s/extensions/vscode-api-tests/src/utils.ts:176:10)\n      at Context.<anonymous> (/Users/runner/work/1/s/extensions/vscode-api-tests/src/singlefolder-tests/terminal.test.ts:775:5)\n\n  2) vscode API - terminal\n       Terminal\n         environmentVariableCollection\n           should have collection variables apply to environment variables that don't exist:\n     Error: Timeout: ~b2~ should be printed after 20 seconds.\nDid not pass accept function\n      at poll (/Users/runner/work/1/s/extensions/vscode-api-tests/src/utils.ts:176:10)\n      at Context.<anonymous> (/Users/runner/work/1/s/extensions/vscode-api-tests/src/singlefolder-tests/terminal.test.ts:820:5)\n\n  3) vscode API - terminal\n       Terminal\n         environmentVariableCollection\n           should respect clearing entries:\n     Error: Timeout: ~b1~ should be printed after 20 seconds.\nDid not pass accept function\n      at poll (/Users/runner/work/1/s/extensions/vscode-api-tests/src/utils.ts:176:10)\n      at Context.<anonymous> (/Users/runner/work/1/s/extensions/vscode-api-tests/src/singlefolder-tests/terminal.test.ts:862:5)\n\n\n```",
  "files_changed": [
    {
      "filename": "extensions/vscode-api-tests/src/singlefolder-tests/terminal.test.ts",
      "status": "modified",
      "patch": "@@ -26,6 +26,8 @@ import { assertNoRpc, poll } from '../utils';\n \t\tawait config.update('gpuAcceleration', 'off', ConfigurationTarget.Global);\n \t\t// Disable env var relaunch for tests to prevent terminals relaunching themselves\n \t\tawait config.update('environmentChangesRelaunch', false, ConfigurationTarget.Global);\n+\t\t// Disable local echo in case it causes any problems in remote tests\n+\t\tawait config.update('localEchoEnabled', \"off\", ConfigurationTarget.Global);\n \t\tawait config.update('shellIntegration.enabled', false);\n \t});\n \n@@ -761,14 +763,9 @@ import { assertNoRpc, poll } from '../utils';\n \t\t\t\t\tdata += sanitizeData(e.data);\n \t\t\t\t}));\n \n-\t\t\t\t// Run both PowerShell and sh commands, errors don't matter we're just looking for\n-\t\t\t\t// the correct output\n-\t\t\t\tterminal.sendText('$env:A');\n-\t\t\t\tterminal.sendText('echo $A');\n-\t\t\t\tterminal.sendText('$env:B');\n-\t\t\t\tterminal.sendText('echo $B');\n-\t\t\t\tterminal.sendText('$env:C');\n-\t\t\t\tterminal.sendText('echo $C');\n+\t\t\t\t// Run sh commands, if this is ever enabled on Windows we would also want to run\n+\t\t\t\t// the pwsh equivalent\n+\t\t\t\tterminal.sendText('echo \"$A $B $C\"');\n \n \t\t\t\t// Poll for the echo results to show up\n \t\t\t\ttry {\n@@ -811,19 +808,19 @@ import { assertNoRpc, poll } from '../utils';\n \t\t\t\t\tdata += sanitizeData(e.data);\n \t\t\t\t}));\n \n-\t\t\t\t// Run both PowerShell and sh commands, errors don't matter we're just looking for\n-\t\t\t\t// the correct output\n-\t\t\t\tterminal.sendText('$env:A');\n-\t\t\t\tterminal.sendText('echo $A');\n-\t\t\t\tterminal.sendText('$env:B');\n-\t\t\t\tterminal.sendText('echo $B');\n-\t\t\t\tterminal.sendText('$env:C');\n-\t\t\t\tterminal.sendText('echo $C');\n+\t\t\t\t// Run sh commands, if this is ever enabled on Windows we would also want to run\n+\t\t\t\t// the pwsh equivalent\n+\t\t\t\tterminal.sendText('echo \"$A $B $C\"');\n \n \t\t\t\t// Poll for the echo results to show up\n-\t\t\t\tawait poll<void>(() => Promise.resolve(), () => data.includes('~a2~'), '~a2~ should be printed');\n-\t\t\t\tawait poll<void>(() => Promise.resolve(), () => data.includes('~b2~'), '~b2~ should be printed');\n-\t\t\t\tawait poll<void>(() => Promise.resolve(), () => data.includes('~c2~'), '~c2~ should be printed');\n+\t\t\t\ttry {\n+\t\t\t\t\tawait poll<void>(() => Promise.resolve(), () => data.includes('~a2~'), '~a2~ should be printed');\n+\t\t\t\t\tawait poll<void>(() => Promise.resolve(), () => data.includes('~b2~'), '~b2~ should be printed');\n+\t\t\t\t\tawait poll<void>(() => Promise.resolve(), () => data.includes('~c2~'), '~c2~ should be printed');\n+\t\t\t\t} catch (err) {\n+\t\t\t\t\tconsole.error('DATA UP UNTIL NOW:', data);\n+\t\t\t\t\tthrow err;\n+\t\t\t\t}\n \n \t\t\t\t// Wait for terminal to be disposed\n \t\t\t\tawait new Promise<void>(r => {\n@@ -855,16 +852,18 @@ import { assertNoRpc, poll } from '../utils';\n \t\t\t\t\tdata += sanitizeData(e.data);\n \t\t\t\t}));\n \n-\t\t\t\t// Run both PowerShell and sh commands, errors don't matter we're just looking for\n-\t\t\t\t// the correct output\n-\t\t\t\tterminal.sendText('$env:A');\n-\t\t\t\tterminal.sendText('echo $A');\n-\t\t\t\tterminal.sendText('$env:B');\n-\t\t\t\tterminal.sendText('echo $B');\n+\t\t\t\t// Run sh commands, if this is ever enabled on Windows we would also want to run\n+\t\t\t\t// the pwsh equivalent\n+\t\t\t\tterminal.sendText('echo \"$A $B\"');\n \n \t\t\t\t// Poll for the echo results to show up\n-\t\t\t\tawait poll<void>(() => Promise.resolve(), () => data.includes('~a1~'), '~a1~ should be printed');\n-\t\t\t\tawait poll<void>(() => Promise.resolve(), () => data.includes('~b1~'), '~b1~ should be printed');\n+\t\t\t\ttry {\n+\t\t\t\t\tawait poll<void>(() => Promise.resolve(), () => data.includes('~a1~'), '~a1~ should be printed');\n+\t\t\t\t\tawait poll<void>(() => Promise.resolve(), () => data.includes('~b1~'), '~b1~ should be printed');\n+\t\t\t\t} catch (err) {\n+\t\t\t\t\tconsole.error('DATA UP UNTIL NOW:', data);\n+\t\t\t\t\tthrow err;\n+\t\t\t\t}\n \n \t\t\t\t// Wait for terminal to be disposed\n \t\t\t\tawait new Promise<void>(r => {\n@@ -896,16 +895,18 @@ import { assertNoRpc, poll } from '../utils';\n \t\t\t\t\tdata += sanitizeData(e.data);\n \t\t\t\t}));\n \n-\t\t\t\t// Run both PowerShell and sh commands, errors don't matter we're just looking for\n-\t\t\t\t// the correct output\n-\t\t\t\tterminal.sendText('$env:A');\n-\t\t\t\tterminal.sendText('echo $A');\n-\t\t\t\tterminal.sendText('$env:B');\n-\t\t\t\tterminal.sendText('echo $B');\n+\t\t\t\t// Run sh commands, if this is ever enabled on Windows we would also want to run\n+\t\t\t\t// the pwsh equivalent\n+\t\t\t\tterminal.sendText('echo \"$A $B\"');\n \n \t\t\t\t// Poll for the echo results to show up\n-\t\t\t\tawait poll<void>(() => Promise.resolve(), () => data.includes('~a1~'), '~a1~ should be printed');\n-\t\t\t\tawait poll<void>(() => Promise.resolve(), () => data.includes('~b2~'), '~b2~ should be printed');\n+\t\t\t\ttry {\n+\t\t\t\t\tawait poll<void>(() => Promise.resolve(), () => data.includes('~a1~'), '~a1~ should be printed');\n+\t\t\t\t\tawait poll<void>(() => Promise.resolve(), () => data.includes('~b2~'), '~b2~ should be printed');\n+\t\t\t\t} catch (err) {\n+\t\t\t\t\tconsole.error('DATA UP UNTIL NOW:', data);\n+\t\t\t\t\tthrow err;\n+\t\t\t\t}\n \n \t\t\t\t// Wait for terminal to be disposed\n \t\t\t\tawait new Promise<void>(r => {"
    }
  ],
  "fix_category": "Other",
  "root_cause_category": "Network",
  "root_cause_subcategory": NaN
}