{
  "id": 140,
  "repo": "kafka",
  "issue_url": "https://github.com/apache/kafka/pull/19601",
  "pr_url": "https://github.com/apache/kafka/pull/19601",
  "issue_description": "The test testShareGroupHeartbeatInitializeOnPartitionUpdate was flaky\nearlier. The shareGroupStatePartitionMetadataRecord that is created\nduring heartbeat contains 2 topics to be initialized,  but the order in\nwhich they appear in the list is not deterministic. The test is changed\nto simply see whether the contents of the record is correct instead of\ndirectly comparing it with an expected record which may contains the\ncorrect topics, but in some different order.\n",
  "files_changed": [
    {
      "filename": "group-coordinator/src/test/java/org/apache/kafka/coordinator/group/GroupMetadataManagerTest.java",
      "status": "modified",
      "patch": "@@ -21260,16 +21260,21 @@ public void testShareGroupHeartbeatInitializeOnPartitionUpdate() {\n                 .setMemberEpoch(0)\n                 .setSubscribedTopicNames(List.of(t1Name, t2Name)));\n \n-        assertTrue(result.records().contains(\n-            newShareGroupStatePartitionMetadataRecord(groupId, mkShareGroupStateMap(List.of(\n-                    mkShareGroupStateMetadataEntry(t1Uuid, t1Name, List.of(0, 1)),\n-                    mkShareGroupStateMetadataEntry(t2Uuid, t2Name, List.of(0, 1))\n-                )),\n-                Map.of(),\n-                Map.of()\n-            ))\n+        CoordinatorRecord expected = newShareGroupStatePartitionMetadataRecord(\n+            groupId,\n+            mkShareGroupStateMap(List.of(\n+                mkShareGroupStateMetadataEntry(t1Uuid, t1Name, List.of(0, 1)),\n+                mkShareGroupStateMetadataEntry(t2Uuid, t2Name, List.of(0, 1))\n+            )),\n+            Map.of(),\n+            Map.of()\n         );\n \n+        Optional<CoordinatorRecord> actual = result.records().stream().filter(record -> record.key() instanceof ShareGroupStatePartitionMetadataKey)\n+            .findAny();\n+        assertTrue(actual.isPresent());\n+        assertRecordEquals(expected, actual.get());\n+\n         verifyShareGroupHeartbeatInitializeRequest(\n             result.response().getValue(),\n             Map.of(\n@@ -21330,18 +21335,23 @@ public void testShareGroupHeartbeatInitializeOnPartitionUpdate() {\n                 .setMemberEpoch(1)\n                 .setSubscribedTopicNames(null));\n \n-        assertTrue(result.records().contains(\n-            newShareGroupStatePartitionMetadataRecord(groupId, mkShareGroupStateMap(List.of(\n-                    mkShareGroupStateMetadataEntry(t1Uuid, t1Name, List.of(2, 3))\n-                )),\n-                mkShareGroupStateMap(List.of(\n-                    mkShareGroupStateMetadataEntry(t1Uuid, t1Name, List.of(0, 1)),\n-                    mkShareGroupStateMetadataEntry(t2Uuid, t2Name, List.of(0, 1))\n-                )),\n-                Map.of()\n-            ))\n+        expected = newShareGroupStatePartitionMetadataRecord(\n+            groupId,\n+            mkShareGroupStateMap(List.of(\n+                mkShareGroupStateMetadataEntry(t1Uuid, t1Name, List.of(2, 3))\n+            )),\n+            mkShareGroupStateMap(List.of(\n+                mkShareGroupStateMetadataEntry(t1Uuid, t1Name, List.of(0, 1)),\n+                mkShareGroupStateMetadataEntry(t2Uuid, t2Name, List.of(0, 1))\n+            )),\n+            Map.of()\n         );\n \n+        actual = result.records().stream().filter(record -> record.key() instanceof ShareGroupStatePartitionMetadataKey)\n+            .findAny();\n+        assertTrue(actual.isPresent());\n+        assertRecordEquals(expected, actual.get());\n+\n         verifyShareGroupHeartbeatInitializeRequest(\n             result.response().getValue(),\n             Map.of("
    }
  ],
  "fix_category": "Change assertion",
  "root_cause_category": "Unordered collections",
  "root_cause_subcategory": NaN
}