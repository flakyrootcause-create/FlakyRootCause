{
  "id": 285,
  "repo": "talos",
  "issue_url": "https://github.com/siderolabs/talos/pull/9974",
  "pr_url": "https://github.com/siderolabs/talos/pull/9974",
  "issue_description": "PRs backported:\r\n\r\n- #9909 \r\n- #9918\r\n- #9919 \r\n- #9920\r\n- #9922 \r\n- #9937 \r\n- #9938 \r\n- #9939 \r\n- #9940 \r\n- #9941 \r\n- #9948 \r\n- #9950 \r\n- #9953 \r\n- #9954 \r\n- #9961 \r\n- #9962 \r\n- #9963 \r\n- #9966 \r\n- #9967 \r\n- #9969\r\n- #9971\r\n- #9972 \r\n- #9934 \r\n- #9968 \r\n- use extension ref `release-1.9`",
  "files_changed": [
    {
      "filename": ".github/renovate.json",
      "status": "modified",
      "patch": "@@ -1,116 +1,80 @@\n {\n     \"$schema\": \"https://docs.renovatebot.com/renovate-schema.json\",\n+    \"description\": \"THIS FILE WAS AUTOMATICALLY GENERATED, PLEASE DO NOT EDIT.\\n\\nGenerated on 2024-12-16T18:02:24Z by kres 318187b.\\n\\n\",\n+    \"prHeader\": \"Update Request | Renovate Bot\",\n     \"extends\": [\n         \":dependencyDashboard\",\n         \":gitSignOff\",\n         \":semanticCommitScopeDisabled\",\n         \"schedule:earlyMondays\"\n     ],\n-    \"prHeader\": \"Update Request | Renovate Bot\",\n-    \"regexManagers\": [\n+    \"customManagers\": [\n         {\n+            \"customType\": \"regex\",\n+            \"versioningTemplate\": \"{{#if versioning}}{{versioning}}{{else}}semver{{/if}}\",\n             \"fileMatch\": [\n                 \"Makefile\"\n             ],\n             \"matchStrings\": [\n                 \"# renovate: datasource=(?<datasource>.*?)(?:\\\\s+extractVersion=(?<extractVersion>.+?))?\\\\s+depName=(?<depName>.+?)\\\\s.*_VERSION\\\\s+\\\\?=\\\\s+(?<currentValue>.+)\"\n-            ],\n-            \"versioningTemplate\": \"{{#if versioning}}{{versioning}}{{else}}semver{{/if}}\"\n+            ]\n         },\n         {\n+            \"customType\": \"regex\",\n+            \"versioningTemplate\": \"{{#if versioning}}{{versioning}}{{else}}semver{{/if}}\",\n             \"fileMatch\": [\n                 \"pkg/machinery/constants/constants.go\"\n             ],\n             \"matchStrings\": [\n                 \"\\\\/\\\\/\\\\s+renovate: datasource=(?<datasource>.*?)(?:\\\\s+extractVersion=(?<extractVersion>.+?))?(?:\\\\s+versioning=(?<versioning>.+?))?\\\\s+depName=(?<depName>.+?)?\\\\s.*Version\\\\s+=\\\\s+\\\\\\\"(?<currentValue>.+?)\\\\\\\"\"\n-            ],\n-            \"versioningTemplate\": \"{{#if versioning}}{{versioning}}{{else}}semver{{/if}}\"\n+            ]\n         },\n         {\n+            \"customType\": \"regex\",\n+            \"versioningTemplate\": \"{{#if versioning}}{{versioning}}{{else}}semver{{/if}}\",\n             \"fileMatch\": [\n                 \"internal/integration/k8s/constants.go\"\n             ],\n             \"matchStrings\": [\n                 \"\\\\/\\\\/\\\\s+renovate: datasource=(?<datasource>.*?)(?:\\\\s+extractVersion=(?<extractVersion>.+?))?(?:\\\\s+versioning=(?<versioning>.+?))?\\\\s+depName=(?<depName>.+?)?(?:\\\\s+registryUrl=(?<registryUrl>.+?))?\\\\s.*Version\\\\s+=\\\\s+\\\\\\\"(?<currentValue>.+?)\\\\\\\"\"\n-            ],\n-            \"versioningTemplate\": \"{{#if versioning}}{{versioning}}{{else}}semver{{/if}}\"\n+            ]\n         },\n         {\n+            \"customType\": \"regex\",\n+            \"datasourceTemplate\": \"docker\",\n+            \"depNameTemplate\": \"docker/dockerfile-upstream\",\n+            \"versioningTemplate\": \"docker\",\n             \"fileMatch\": [\n                 \"Dockerfile\"\n             ],\n             \"matchStrings\": [\n                 \"# syntax = docker\\\\/dockerfile-upstream:(?<currentValue>.*)\"\n-            ],\n-            \"depNameTemplate\": \"docker/dockerfile-upstream\",\n-            \"datasourceTemplate\": \"docker\",\n-            \"versioningTemplate\": \"docker\"\n+            ]\n         }\n     ],\n     \"packageRules\": [\n         {\n-            \"enabled\": false,\n-            \"matchDatasources\": [\n-                \"docker\"\n-            ],\n-            \"matchFiles\": [\n-                \"hack/test/libvirt/docker-compose.yaml\"\n+            \"groupName\": \"dependencies\",\n+            \"matchUpdateTypes\": [\n+                \"major\",\n+                \"minor\",\n+                \"patch\",\n+                \"pin\",\n+                \"digest\"\n             ]\n         },\n         {\n             \"enabled\": false,\n-            \"matchDatasources\": [\n-                \"npm\"\n-            ],\n-            \"matchPaths\": [\n-                \"website/\"\n+            \"matchFileNames\": [\n+                \"website/**\"\n             ]\n         },\n         {\n+            \"versioning\": \"regex:^(?<major>\\\\d+)\\\\.(?<minor>\\\\d+)\",\n             \"matchPackageNames\": [\n                 \"golang/go\"\n-            ],\n-            \"versioning\": \"regex:^(?<major>\\\\d+)\\\\.(?<minor>\\\\d+)\"\n-        },\n-        {\n-            \"matchPackagePatterns\": [\n-                \"*\"\n-            ],\n-            \"matchDatasources\": [\n-                \"docker\"\n-            ],\n-            \"groupName\": \"container images\"\n-        },\n-        {\n-            \"matchPackagePatterns\": [\n-                \"*\"\n-            ],\n-            \"matchDatasources\": [\n-                \"go\",\n-                \"golang-version\"\n-            ],\n-            \"groupName\": \"go packages\"\n-        },\n-        {\n-            \"matchPackagePatterns\": [\n-                \"*\"\n-            ],\n-            \"matchDatasources\": [\n-                \"npm\"\n-            ],\n-            \"groupName\": \"node packages\"\n-        },\n-        {\n-            \"matchPackagePatterns\": [\n-                \"*\"\n-            ],\n-            \"matchDatasources\": [\n-                \"git-refs\",\n-                \"git-tags\",\n-                \"github-tags\",\n-                \"github-releases\"\n-            ],\n-            \"groupName\": \"releases\"\n+            ]\n         }\n-    ]\n+    ],\n+    \"separateMajorMinor\": false\n }"
    },
    {
      "filename": ".github/workflows/ci.yaml",
      "status": "modified",
      "patch": "@@ -1,6 +1,6 @@\n # THIS FILE WAS AUTOMATICALLY GENERATED, PLEASE DO NOT EDIT.\n #\n-# Generated on 2024-12-06T17:21:12Z by kres 1ebe796.\n+# Generated on 2024-12-17T10:40:00Z by kres 318187b.\n \n name: default\n concurrency:\n@@ -592,7 +592,7 @@ jobs:\n         uses: actions/checkout@v4\n         with:\n           path: _out/extensions\n-          ref: main\n+          ref: release-1.9\n           repository: siderolabs/extensions\n       - name: set variables\n         run: |\n@@ -746,7 +746,7 @@ jobs:\n         uses: actions/checkout@v4\n         with:\n           path: _out/extensions\n-          ref: main\n+          ref: release-1.9\n           repository: siderolabs/extensions\n       - name: set variables\n         run: |\n@@ -1438,7 +1438,7 @@ jobs:\n         uses: actions/checkout@v4\n         with:\n           path: _out/extensions\n-          ref: main\n+          ref: release-1.9\n           repository: siderolabs/extensions\n       - name: unshallow-extensions\n         run: |\n@@ -1680,7 +1680,7 @@ jobs:\n       - name: image-cache\n         env:\n           IMAGE_REGISTRY: registry.dev.siderolabs.io\n-          MORE_IMAGES: alpine;registry.k8s.io/conformance:v1.32.0-rc.1;registry.k8s.io/e2e-test-images/busybox:1.36.1-1;registry.k8s.io/e2e-test-images/agnhost:2.53;registry.k8s.io/e2e-test-images/httpd:2.4.38-4;registry.k8s.io/e2e-test-images/nonewprivs:1.3;registry.k8s.io/e2e-test-images/jessie-dnsutils:1.7;registry.k8s.io/e2e-test-images/nautilus:1.7;registry.k8s.io/e2e-test-images/sample-apiserver:1.29.2;registry.k8s.io/e2e-test-images/nginx:1.14-4;registry.k8s.io/etcd:3.5.16-0;registry.k8s.io/e2e-test-images/httpd:2.4.39-4\n+          MORE_IMAGES: alpine;registry.k8s.io/conformance:v1.32.0;registry.k8s.io/e2e-test-images/busybox:1.36.1-1;registry.k8s.io/e2e-test-images/agnhost:2.53;registry.k8s.io/e2e-test-images/httpd:2.4.38-4;registry.k8s.io/e2e-test-images/nonewprivs:1.3;registry.k8s.io/e2e-test-images/jessie-dnsutils:1.7;registry.k8s.io/e2e-test-images/nautilus:1.7;registry.k8s.io/e2e-test-images/sample-apiserver:1.29.2;registry.k8s.io/e2e-test-images/nginx:1.14-4;registry.k8s.io/etcd:3.5.16-0;registry.k8s.io/e2e-test-images/httpd:2.4.39-4\n           PLATFORM: linux/amd64,linux/arm64\n           PUSH: \"true\"\n         run: |\n@@ -2074,6 +2074,7 @@ jobs:\n           GITHUB_STEP_NAME: ${{ github.job}}-e2e-controlplane-port\n           IMAGE_REGISTRY: registry.dev.siderolabs.io\n           SHORT_INTEGRATION_TEST: \"yes\"\n+          WITH_CONFIG_PATCH: '@hack/test/patches/ephemeral-min-max.yaml'\n           WITH_CONTROL_PLANE_PORT: \"443\"\n         run: |\n           sudo -E make e2e-qemu\n@@ -3021,7 +3022,7 @@ jobs:\n         uses: actions/checkout@v4\n         with:\n           path: _out/extensions\n-          ref: main\n+          ref: release-1.9\n           repository: siderolabs/extensions\n       - name: set variables\n         run: |"
    },
    {
      "filename": ".github/workflows/integration-aws-nvidia-nonfree-cron.yaml",
      "status": "modified",
      "patch": "@@ -1,6 +1,6 @@\n # THIS FILE WAS AUTOMATICALLY GENERATED, PLEASE DO NOT EDIT.\n #\n-# Generated on 2024-09-09T13:58:35Z by kres 8be5fa7.\n+# Generated on 2024-12-17T10:40:00Z by kres 318187b.\n \n name: integration-aws-nvidia-nonfree-cron\n concurrency:\n@@ -105,7 +105,7 @@ jobs:\n         uses: actions/checkout@v4\n         with:\n           path: _out/extensions\n-          ref: main\n+          ref: release-1.9\n           repository: siderolabs/extensions\n       - name: set variables\n         run: |"
    },
    {
      "filename": ".github/workflows/integration-aws-nvidia-oss-cron.yaml",
      "status": "modified",
      "patch": "@@ -1,6 +1,6 @@\n # THIS FILE WAS AUTOMATICALLY GENERATED, PLEASE DO NOT EDIT.\n #\n-# Generated on 2024-09-09T13:58:35Z by kres 8be5fa7.\n+# Generated on 2024-12-17T10:40:00Z by kres 318187b.\n \n name: integration-aws-nvidia-oss-cron\n concurrency:\n@@ -105,7 +105,7 @@ jobs:\n         uses: actions/checkout@v4\n         with:\n           path: _out/extensions\n-          ref: main\n+          ref: release-1.9\n           repository: siderolabs/extensions\n       - name: set variables\n         run: |"
    },
    {
      "filename": ".github/workflows/integration-extensions-cron.yaml",
      "status": "modified",
      "patch": "@@ -1,6 +1,6 @@\n # THIS FILE WAS AUTOMATICALLY GENERATED, PLEASE DO NOT EDIT.\n #\n-# Generated on 2024-12-04T12:34:25Z by kres 232fe63.\n+# Generated on 2024-12-17T10:40:00Z by kres 318187b.\n \n name: integration-extensions-cron\n concurrency:\n@@ -86,7 +86,7 @@ jobs:\n         uses: actions/checkout@v4\n         with:\n           path: _out/extensions\n-          ref: main\n+          ref: release-1.9\n           repository: siderolabs/extensions\n       - name: unshallow-extensions\n         run: |"
    },
    {
      "filename": ".github/workflows/integration-misc-0-cron.yaml",
      "status": "modified",
      "patch": "@@ -1,6 +1,6 @@\n # THIS FILE WAS AUTOMATICALLY GENERATED, PLEASE DO NOT EDIT.\n #\n-# Generated on 2024-11-28T13:53:18Z by kres 232fe63.\n+# Generated on 2024-12-11T13:30:10Z by kres 8183c20.\n \n name: integration-misc-0-cron\n concurrency:\n@@ -99,6 +99,7 @@ jobs:\n           GITHUB_STEP_NAME: ${{ github.job}}-e2e-controlplane-port\n           IMAGE_REGISTRY: registry.dev.siderolabs.io\n           SHORT_INTEGRATION_TEST: \"yes\"\n+          WITH_CONFIG_PATCH: '@hack/test/patches/ephemeral-min-max.yaml'\n           WITH_CONTROL_PLANE_PORT: \"443\"\n         run: |\n           sudo -E make e2e-qemu"
    },
    {
      "filename": ".github/workflows/integration-qemu-csi-longhorn-cron.yaml",
      "status": "modified",
      "patch": "@@ -1,6 +1,6 @@\n # THIS FILE WAS AUTOMATICALLY GENERATED, PLEASE DO NOT EDIT.\n #\n-# Generated on 2024-11-28T13:53:18Z by kres 232fe63.\n+# Generated on 2024-12-17T10:40:00Z by kres 318187b.\n \n name: integration-qemu-csi-longhorn-cron\n concurrency:\n@@ -86,7 +86,7 @@ jobs:\n         uses: actions/checkout@v4\n         with:\n           path: _out/extensions\n-          ref: main\n+          ref: release-1.9\n           repository: siderolabs/extensions\n       - name: set variables\n         run: |"
    },
    {
      "filename": ".kres.yaml",
      "status": "modified",
      "patch": "@@ -684,6 +684,7 @@ spec:\n             SHORT_INTEGRATION_TEST: yes\n             WITH_CONTROL_PLANE_PORT: 443\n             IMAGE_REGISTRY: registry.dev.siderolabs.io\n+            WITH_CONFIG_PATCH: \"@hack/test/patches/ephemeral-min-max.yaml\"\n         - name: save-talos-logs\n           conditions:\n             - always\n@@ -1037,7 +1038,7 @@ spec:\n         - name: checkout extensions\n           checkoutStep:\n             repository: siderolabs/extensions\n-            ref: main\n+            ref: release-1.9\n             path: _out/extensions\n         - name: unshallow-extensions\n           nonMakeStep: true\n@@ -1378,7 +1379,7 @@ spec:\n         - name: checkout extensions\n           checkoutStep:\n             repository: siderolabs/extensions\n-            ref: main\n+            ref: release-1.9\n             path: _out/extensions\n         - name: set variables\n           nonMakeStep: true\n@@ -1548,7 +1549,7 @@ spec:\n             PLATFORM: linux/amd64,linux/arm64\n             IMAGE_REGISTRY: registry.dev.siderolabs.io\n             PUSH: true\n-            MORE_IMAGES: \"alpine;registry.k8s.io/conformance:v1.32.0-rc.1;registry.k8s.io/e2e-test-images/busybox:1.36.1-1;registry.k8s.io/e2e-test-images/agnhost:2.53;registry.k8s.io/e2e-test-images/httpd:2.4.38-4;registry.k8s.io/e2e-test-images/nonewprivs:1.3;registry.k8s.io/e2e-test-images/jessie-dnsutils:1.7;registry.k8s.io/e2e-test-images/nautilus:1.7;registry.k8s.io/e2e-test-images/sample-apiserver:1.29.2;registry.k8s.io/e2e-test-images/nginx:1.14-4;registry.k8s.io/etcd:3.5.16-0;registry.k8s.io/e2e-test-images/httpd:2.4.39-4\"\n+            MORE_IMAGES: \"alpine;registry.k8s.io/conformance:v1.32.0;registry.k8s.io/e2e-test-images/busybox:1.36.1-1;registry.k8s.io/e2e-test-images/agnhost:2.53;registry.k8s.io/e2e-test-images/httpd:2.4.38-4;registry.k8s.io/e2e-test-images/nonewprivs:1.3;registry.k8s.io/e2e-test-images/jessie-dnsutils:1.7;registry.k8s.io/e2e-test-images/nautilus:1.7;registry.k8s.io/e2e-test-images/sample-apiserver:1.29.2;registry.k8s.io/e2e-test-images/nginx:1.14-4;registry.k8s.io/etcd:3.5.16-0;registry.k8s.io/e2e-test-images/httpd:2.4.39-4\"\n         - name: e2e-image-cache\n           command: e2e-qemu\n           withSudo: true\n@@ -1838,7 +1839,7 @@ spec:\n         - name: checkout extensions\n           checkoutStep:\n             repository: siderolabs/extensions\n-            ref: main\n+            ref: release-1.9\n             path: _out/extensions\n         - name: set variables\n           nonMakeStep: true\n@@ -1935,7 +1936,7 @@ spec:\n         - name: checkout extensions\n           checkoutStep:\n             repository: siderolabs/extensions\n-            ref: main\n+            ref: release-1.9\n             path: _out/extensions\n         - name: set variables\n           nonMakeStep: true\n@@ -2188,3 +2189,40 @@ spec:\n             TF_SCRIPT_DIR: _out/contrib\n             TF_E2E_TEST_TYPE: equinix-metal\n             TF_E2E_ACTION: destroy\n+---\n+kind: common.Renovate\n+spec:\n+  customManagers:\n+    - customType: regex\n+      fileMatch:\n+        - Makefile\n+      matchStrings:\n+        - '# renovate: datasource=(?<datasource>.*?)(?:\\s+extractVersion=(?<extractVersion>.+?))?\\s+depName=(?<depName>.+?)\\s.*_VERSION\\s+\\?=\\s+(?<currentValue>.+)'\n+      versioningTemplate: \"{{#if versioning}}{{versioning}}{{else}}semver{{/if}}\"\n+    - customType: regex\n+      fileMatch:\n+        - pkg/machinery/constants/constants.go\n+      matchStrings:\n+        - '\\/\\/\\s+renovate: datasource=(?<datasource>.*?)(?:\\s+extractVersion=(?<extractVersion>.+?))?(?:\\s+versioning=(?<versioning>.+?))?\\s+depName=(?<depName>.+?)?\\s.*Version\\s+=\\s+\\\"(?<currentValue>.+?)\\\"'\n+      versioningTemplate: \"{{#if versioning}}{{versioning}}{{else}}semver{{/if}}\"\n+    - customType: regex\n+      fileMatch:\n+        - internal/integration/k8s/constants.go\n+      matchStrings:\n+        - '\\/\\/\\s+renovate: datasource=(?<datasource>.*?)(?:\\s+extractVersion=(?<extractVersion>.+?))?(?:\\s+versioning=(?<versioning>.+?))?\\s+depName=(?<depName>.+?)?(?:\\s+registryUrl=(?<registryUrl>.+?))?\\s.*Version\\s+=\\s+\\\"(?<currentValue>.+?)\\\"'\n+      versioningTemplate: \"{{#if versioning}}{{versioning}}{{else}}semver{{/if}}\"\n+    - customType: regex\n+      fileMatch:\n+        - Dockerfile\n+      matchStrings:\n+        - '# syntax = docker\\/dockerfile-upstream:(?<currentValue>.*)'\n+      depNameTemplate: docker/dockerfile-upstream\n+      datasourceTemplate: docker\n+      versioningTemplate: docker\n+  packageRules:\n+    - enabled: false\n+      matchFileNames:\n+        - \"website/**\"\n+    - matchPackageNames:\n+        - golang/go\n+      versioning: 'regex:^(?<major>\\d+)\\.(?<minor>\\d+)'"
    },
    {
      "filename": "Makefile",
      "status": "modified",
      "patch": "@@ -22,7 +22,7 @@ TOOLS ?= ghcr.io/siderolabs/tools:v1.9.0-1-geaad82f\n DEBUG_TOOLS_SOURCE := scratch\n \n PKGS_PREFIX ?= ghcr.io/siderolabs\n-PKGS ?= v1.9.0-6-gabba1d8\n+PKGS ?= v1.9.0-12-g9576b97\n EXTRAS ?= v1.9.0\n \n KRES_IMAGE ?= ghcr.io/siderolabs/kres:latest\n@@ -107,7 +107,7 @@ INTEGRATION_TEST := integration-test\n INTEGRATION_TEST_DEFAULT_TARGET := $(INTEGRATION_TEST)-$(OPERATING_SYSTEM)\n INTEGRATION_TEST_PROVISION_DEFAULT_TARGET := integration-test-provision-$(OPERATING_SYSTEM)\n # renovate: datasource=github-releases depName=kubernetes/kubernetes\n-KUBECTL_VERSION ?= v1.32.0-rc.1\n+KUBECTL_VERSION ?= v1.32.0\n # renovate: datasource=github-releases depName=kastenhq/kubestr\n KUBESTR_VERSION ?= v0.4.46\n # renovate: datasource=github-releases depName=helm/helm\n@@ -251,7 +251,7 @@ COMMON_ARGS += --build-arg=MICROSOFT_SECUREBOOT_RELEASE=$(MICROSOFT_SECUREBOOT_R\n \n CI_ARGS ?=\n \n-EXTENSIONS_FILTER_COMMAND ?= grep -vE 'tailscale|xen-guest-agent|nvidia|vmtoolsd-guest-agent|metal-agent'\n+EXTENSIONS_FILTER_COMMAND ?= grep -vE 'tailscale|xen-guest-agent|nvidia|vmtoolsd-guest-agent|metal-agent|cloudflared'\n \n all: initramfs kernel installer imager talosctl talosctl-image talos\n "
    },
    {
      "filename": "api/resource/definitions/network/network.proto",
      "status": "modified",
      "patch": "@@ -184,6 +184,8 @@ message LinkStatusSpec {\n   BondMasterSpec bond_master = 28;\n   WireguardSpec wireguard = 29;\n   bytes permanent_addr = 30;\n+  string alias = 31;\n+  repeated string alt_names = 32;\n }\n \n // NfTablesAddressMatch describes the match on the IP address."
    },
    {
      "filename": "cmd/talosctl/cmd/mgmt/cluster/create.go",
      "status": "modified",
      "patch": "@@ -119,6 +119,7 @@ var (\n \tnodeVmlinuzPath           string\n \tnodeInitramfsPath         string\n \tnodeISOPath               string\n+\tnodeUSBPath               string\n \tnodeDiskImagePath         string\n \tnodeIPXEBootScript        string\n \tapplyConfigEnabled        bool\n@@ -223,6 +224,9 @@ func downloadBootAssets(ctx context.Context) error {\n \t\t{\n \t\t\tpath: &nodeISOPath,\n \t\t},\n+\t\t{\n+\t\t\tpath: &nodeUSBPath,\n+\t\t},\n \t\t{\n \t\t\tpath: &nodeDiskImagePath,\n \t\t},\n@@ -462,6 +466,7 @@ func create(ctx context.Context) error {\n \t\tKernelPath:     nodeVmlinuzPath,\n \t\tInitramfsPath:  nodeInitramfsPath,\n \t\tISOPath:        nodeISOPath,\n+\t\tUSBPath:        nodeUSBPath,\n \t\tIPXEBootScript: nodeIPXEBootScript,\n \t\tDiskImagePath:  nodeDiskImagePath,\n \n@@ -1239,6 +1244,7 @@ func init() {\n \tcreateCmd.Flags().StringVar(&nodeInstallImage, nodeInstallImageFlag, helpers.DefaultImage(images.DefaultInstallerImageRepository), \"the installer image to use\")\n \tcreateCmd.Flags().StringVar(&nodeVmlinuzPath, \"vmlinuz-path\", helpers.ArtifactPath(constants.KernelAssetWithArch), \"the compressed kernel image to use\")\n \tcreateCmd.Flags().StringVar(&nodeISOPath, \"iso-path\", \"\", \"the ISO path to use for the initial boot (VM only)\")\n+\tcreateCmd.Flags().StringVar(&nodeUSBPath, \"usb-path\", \"\", \"the USB stick image path to use for the initial boot (VM only)\")\n \tcreateCmd.Flags().StringVar(&nodeInitramfsPath, \"initrd-path\", helpers.ArtifactPath(constants.InitramfsAssetWithArch), \"initramfs image to use\")\n \tcreateCmd.Flags().StringVar(&nodeDiskImagePath, \"disk-image-path\", \"\", \"disk image to use\")\n \tcreateCmd.Flags().StringVar(&nodeIPXEBootScript, \"ipxe-boot-script\", \"\", \"iPXE boot script (URL) to use\")"
    },
    {
      "filename": "cmd/talosctl/cmd/talos/image.go",
      "status": "modified",
      "patch": "@@ -48,7 +48,7 @@ func (flags imageCmdFlagsType) apiNamespace() (common.ContainerdNamespace, error\n var imageCmd = &cobra.Command{\n \tUse:     \"image\",\n \tAliases: []string{\"images\"},\n-\tShort:   \"Manage CRI containter images\",\n+\tShort:   \"Manage CRI container images\",\n \tLong:    ``,\n \tArgs:    cobra.NoArgs,\n }"
    },
    {
      "filename": "go.mod",
      "status": "modified",
      "patch": "@@ -32,16 +32,16 @@ replace github.com/insomniacslk/dhcp => github.com/smira/dhcp v0.0.0-20241001122\n \n // Kubernetes dependencies sharing the same version.\n require (\n-\tk8s.io/api v0.32.0-rc.1\n-\tk8s.io/apimachinery v0.32.0-rc.1\n-\tk8s.io/apiserver v0.32.0-rc.1\n-\tk8s.io/client-go v0.32.0-rc.1\n-\tk8s.io/component-base v0.32.0-rc.1\n-\tk8s.io/cri-api v0.32.0-rc.1\n-\tk8s.io/kube-scheduler v0.32.0-rc.1\n-\tk8s.io/kubectl v0.32.0-rc.1\n-\tk8s.io/kubelet v0.32.0-rc.1\n-\tk8s.io/pod-security-admission v0.32.0-rc.1\n+\tk8s.io/api v0.32.0\n+\tk8s.io/apimachinery v0.32.0\n+\tk8s.io/apiserver v0.32.0\n+\tk8s.io/client-go v0.32.0\n+\tk8s.io/component-base v0.32.0\n+\tk8s.io/cri-api v0.32.0\n+\tk8s.io/kube-scheduler v0.32.0\n+\tk8s.io/kubectl v0.32.0\n+\tk8s.io/kubelet v0.32.0\n+\tk8s.io/pod-security-admission v0.32.0\n )\n \n require (\n@@ -61,7 +61,7 @@ require (\n \tgithub.com/cenkalti/backoff/v4 v4.3.0\n \tgithub.com/containerd/cgroups/v3 v3.0.4\n \tgithub.com/containerd/containerd/api v1.8.0\n-\tgithub.com/containerd/containerd/v2 v2.0.0\n+\tgithub.com/containerd/containerd/v2 v2.0.1\n \tgithub.com/containerd/errdefs v1.0.0\n \tgithub.com/containerd/log v0.1.0\n \tgithub.com/containerd/platforms v1.0.0-rc.0\n@@ -70,7 +70,7 @@ require (\n \tgithub.com/containernetworking/plugins v1.6.0\n \tgithub.com/coredns/coredns v1.11.3\n \tgithub.com/coreos/go-iptables v0.8.0\n-\tgithub.com/cosi-project/runtime v0.7.2\n+\tgithub.com/cosi-project/runtime v0.7.6\n \tgithub.com/distribution/reference v0.6.0\n \tgithub.com/docker/cli v27.3.1+incompatible\n \tgithub.com/docker/docker v27.3.1+incompatible\n@@ -104,7 +104,7 @@ require (\n \tgithub.com/hetznercloud/hcloud-go/v2 v2.17.0\n \tgithub.com/insomniacslk/dhcp v0.0.0-20240829085014-a3a4c1f04475\n \tgithub.com/jeromer/syslogparser v1.1.0\n-\tgithub.com/jsimonetti/rtnetlink/v2 v2.0.2\n+\tgithub.com/jsimonetti/rtnetlink/v2 v2.0.3-0.20241216183107-2d6e9f8ad3f2\n \tgithub.com/jxskiss/base62 v1.1.0\n \tgithub.com/klauspost/compress v1.17.11\n \tgithub.com/klauspost/cpuid/v2 v2.2.9\n@@ -142,7 +142,7 @@ require (\n \tgithub.com/siderolabs/gen v0.7.0\n \tgithub.com/siderolabs/go-api-signature v0.3.6\n \tgithub.com/siderolabs/go-blockdevice v0.4.8\n-\tgithub.com/siderolabs/go-blockdevice/v2 v2.0.6\n+\tgithub.com/siderolabs/go-blockdevice/v2 v2.0.7\n \tgithub.com/siderolabs/go-circular v0.2.1\n \tgithub.com/siderolabs/go-cmd v0.1.3\n \tgithub.com/siderolabs/go-copy v0.1.0\n@@ -179,15 +179,15 @@ require (\n \tgo.etcd.io/etcd/etcdutl/v3 v3.5.17\n \tgo.uber.org/zap v1.27.0\n \tgo4.org/netipx v0.0.0-20231129151722-fdeea329fbba\n-\tgolang.org/x/net v0.31.0\n+\tgolang.org/x/net v0.32.0\n \tgolang.org/x/oauth2 v0.24.0\n-\tgolang.org/x/sync v0.9.0\n-\tgolang.org/x/sys v0.27.0\n-\tgolang.org/x/term v0.26.0\n-\tgolang.org/x/text v0.20.0\n+\tgolang.org/x/sync v0.10.0\n+\tgolang.org/x/sys v0.28.0\n+\tgolang.org/x/term v0.27.0\n+\tgolang.org/x/text v0.21.0\n \tgolang.org/x/time v0.8.0\n \tgolang.zx2c4.com/wireguard/wgctrl v0.0.0-20230429144221-925a1e7659e6\n-\tgoogle.golang.org/grpc v1.68.0\n+\tgoogle.golang.org/grpc v1.68.1\n \tgoogle.golang.org/protobuf v1.35.2\n \tgopkg.in/yaml.v3 v3.0.1\n \tk8s.io/klog/v2 v2.130.1\n@@ -234,7 +234,7 @@ require (\n \tgithub.com/containerd/continuity v0.4.4 // indirect\n \tgithub.com/containerd/errdefs/pkg v0.3.0 // indirect\n \tgithub.com/containerd/fifo v1.1.0 // indirect\n-\tgithub.com/containerd/go-cni v1.1.10 // indirect\n+\tgithub.com/containerd/go-cni v1.1.11 // indirect\n \tgithub.com/containerd/plugin v1.0.0 // indirect\n \tgithub.com/containerd/stargz-snapshotter/estargz v0.14.3 // indirect\n \tgithub.com/containerd/ttrpc v1.2.6 // indirect\n@@ -351,18 +351,18 @@ require (\n \tgo.opentelemetry.io/otel/metric v1.31.0 // indirect\n \tgo.opentelemetry.io/otel/trace v1.31.0 // indirect\n \tgo.uber.org/multierr v1.11.0 // indirect\n-\tgolang.org/x/crypto v0.29.0 // indirect\n+\tgolang.org/x/crypto v0.30.0 // indirect\n \tgolang.org/x/exp v0.0.0-20241108190413-2d47ceb2692f // indirect\n \tgolang.org/x/mod v0.22.0 // indirect\n \tgolang.org/x/tools v0.27.0 // indirect\n \tgolang.zx2c4.com/wintun v0.0.0-20230126152724-0fa3db229ce2 // indirect\n \tgolang.zx2c4.com/wireguard v0.0.0-20231211153847-12269c276173 // indirect\n-\tgoogle.golang.org/genproto/googleapis/api v0.0.0-20241118233622-e639e219e697 // indirect\n-\tgoogle.golang.org/genproto/googleapis/rpc v0.0.0-20241118233622-e639e219e697 // indirect\n+\tgoogle.golang.org/genproto/googleapis/api v0.0.0-20241206012308-a4fef0638583 // indirect\n+\tgoogle.golang.org/genproto/googleapis/rpc v0.0.0-20241206012308-a4fef0638583 // indirect\n \tgopkg.in/evanphx/json-patch.v4 v4.12.0 // indirect\n \tgopkg.in/inf.v0 v0.9.1 // indirect\n \tgopkg.in/yaml.v2 v2.4.0 // indirect\n-\tk8s.io/cli-runtime v0.32.0-rc.1 // indirect\n+\tk8s.io/cli-runtime v0.32.0 // indirect\n \tk8s.io/kube-openapi v0.0.0-20241105132330-32ad38e42d3f // indirect\n \tk8s.io/utils v0.0.0-20241104100929-3ea5e8cea738 // indirect\n \tkernel.org/pub/linux/libs/security/libcap/psx v1.2.72 // indirect"
    },
    {
      "filename": "go.sum",
      "status": "modified",
      "patch": "@@ -129,8 +129,8 @@ github.com/containerd/cgroups/v3 v3.0.4 h1:2fs7l3P0Qxb1nKWuJNFiwhp2CqiKzho71DQkD\n github.com/containerd/cgroups/v3 v3.0.4/go.mod h1:SA5DLYnXO8pTGYiAHXz94qvLQTKfVM5GEVisn4jpins=\n github.com/containerd/containerd/api v1.8.0 h1:hVTNJKR8fMc/2Tiw60ZRijntNMd1U+JVMyTRdsD2bS0=\n github.com/containerd/containerd/api v1.8.0/go.mod h1:dFv4lt6S20wTu/hMcP4350RL87qPWLVa/OHOwmmdnYc=\n-github.com/containerd/containerd/v2 v2.0.0 h1:qLDdFaAykQrIyLiqwQrNLLz95wiC36bAZVwioUwqShM=\n-github.com/containerd/containerd/v2 v2.0.0/go.mod h1:j25kDy9P48/ngb1sxWIFfK6GsnqOHoSqo1EpAod20VQ=\n+github.com/containerd/containerd/v2 v2.0.1 h1:xqSar9cjkGhfQ2YvanCu7FMLk6+pNCFMCAroM2ALPp0=\n+github.com/containerd/containerd/v2 v2.0.1/go.mod h1:A9DyAg+lXTiSBOsBTqQtJL4O3AGaM1aa4UHmVh4uFhM=\n github.com/containerd/continuity v0.4.4 h1:/fNVfTJ7wIl/YPMHjf+5H32uFhl63JucB34PlCpMKII=\n github.com/containerd/continuity v0.4.4/go.mod h1:/lNJvtJKUQStBzpVQ1+rasXO1LAWtUQssk28EZvJ3nE=\n github.com/containerd/errdefs v1.0.0 h1:tg5yIfIlQIrxYtu9ajqY42W3lpS19XqdxRQeEwYG8PI=\n@@ -139,8 +139,8 @@ github.com/containerd/errdefs/pkg v0.3.0 h1:9IKJ06FvyNlexW690DXuQNx2KA2cUJXx151X\n github.com/containerd/errdefs/pkg v0.3.0/go.mod h1:NJw6s9HwNuRhnjJhM7pylWwMyAkmCQvQ4GpJHEqRLVk=\n github.com/containerd/fifo v1.1.0 h1:4I2mbh5stb1u6ycIABlBw9zgtlK8viPI9QkQNRQEEmY=\n github.com/containerd/fifo v1.1.0/go.mod h1:bmC4NWMbXlt2EZ0Hc7Fx7QzTFxgPID13eH0Qu+MAb2o=\n-github.com/containerd/go-cni v1.1.10 h1:c2U73nld7spSWfiJwSh/8W9DK+/qQwYM2rngIhCyhyg=\n-github.com/containerd/go-cni v1.1.10/go.mod h1:/Y/sL8yqYQn1ZG1om1OncJB1W4zN3YmjfP/ShCzG/OY=\n+github.com/containerd/go-cni v1.1.11 h1:fWt1K15AmSLsEfa57N+qYw4NeGPiQKYq1pjNGJwV9mc=\n+github.com/containerd/go-cni v1.1.11/go.mod h1:/Y/sL8yqYQn1ZG1om1OncJB1W4zN3YmjfP/ShCzG/OY=\n github.com/containerd/log v0.1.0 h1:TCJt7ioM2cr/tfR8GPbGf9/VRAX8D2B4PjzCpfX540I=\n github.com/containerd/log v0.1.0/go.mod h1:VRRf09a7mHDIRezVKTRCrOq78v577GXq3bSa3EhrzVo=\n github.com/containerd/platforms v1.0.0-rc.0 h1:GuHWSKgVVO3POn6nRBB4sH63uPOLa87yuuhsGLWaXAA=\n@@ -165,8 +165,8 @@ github.com/coreos/go-semver v0.3.1 h1:yi21YpKnrx1gt5R+la8n5WgS0kCrsPp33dmEyHReZr\n github.com/coreos/go-semver v0.3.1/go.mod h1:irMmmIw/7yzSRPWryHsK7EYSg09caPQL03VsM8rvUec=\n github.com/coreos/go-systemd/v22 v22.5.0 h1:RrqgGjYQKalulkV8NGVIfkXQf6YYmOyiJKk8iXXhfZs=\n github.com/coreos/go-systemd/v22 v22.5.0/go.mod h1:Y58oyj3AT4RCenI/lSvhwexgC+NSVTIJ3seZv2GcEnc=\n-github.com/cosi-project/runtime v0.7.2 h1:b8/v/YpP75LNYLyP5x0+EdqPWtNn6sfJggGGzkqZ0H4=\n-github.com/cosi-project/runtime v0.7.2/go.mod h1:EMLs8a55tJ6zA4UyDbRsTvXBd6UIlNwZfCVGvCyiXK8=\n+github.com/cosi-project/runtime v0.7.6 h1:G6w4/g6EXrMakji0fHRDHvs9wltqF9LSDU/33er8gdc=\n+github.com/cosi-project/runtime v0.7.6/go.mod h1:AmDu/IfE/Q0YYzWRnAkDw2GNuMazpNpN9qyV1IErZdc=\n github.com/cpuguy83/go-md2man/v2 v2.0.2/go.mod h1:tgQtvFlXSQOSOSIRvRPT7W67SCa46tRHOmNcaadrF8o=\n github.com/cpuguy83/go-md2man/v2 v2.0.4/go.mod h1:tgQtvFlXSQOSOSIRvRPT7W67SCa46tRHOmNcaadrF8o=\n github.com/cpuguy83/go-md2man/v2 v2.0.5 h1:ZtcqGrnekaHpVLArFSe4HK5DoKx1T0rq2DwVB0alcyc=\n@@ -414,8 +414,8 @@ github.com/jsimonetti/rtnetlink v0.0.0-20210525051524-4cc836578190/go.mod h1:NmK\n github.com/jsimonetti/rtnetlink v0.0.0-20211022192332-93da33804786/go.mod h1:v4hqbTdfQngbVSZJVWUhGE/lbTFf9jb+ygmNUDQMuOs=\n github.com/jsimonetti/rtnetlink v1.3.5 h1:hVlNQNRlLDGZz31gBPicsG7Q53rnlsz1l1Ix/9XlpVA=\n github.com/jsimonetti/rtnetlink v1.3.5/go.mod h1:0LFedyiTkebnd43tE4YAkWGIq9jQphow4CcwxaT2Y00=\n-github.com/jsimonetti/rtnetlink/v2 v2.0.2 h1:ZKlbCujrIpp4/u3V2Ka0oxlf4BCkt6ojkvpy3nZoCBY=\n-github.com/jsimonetti/rtnetlink/v2 v2.0.2/go.mod h1:7MoNYNbb3UaDHtF8udiJo/RH6VsTKP1pqKLUTVCvToE=\n+github.com/jsimonetti/rtnetlink/v2 v2.0.3-0.20241216183107-2d6e9f8ad3f2 h1:4pspWog/mjnfv+B3rjEUfCoFL80T7J8ojK9ay8ApPCM=\n+github.com/jsimonetti/rtnetlink/v2 v2.0.3-0.20241216183107-2d6e9f8ad3f2/go.mod h1:7MoNYNbb3UaDHtF8udiJo/RH6VsTKP1pqKLUTVCvToE=\n github.com/json-iterator/go v1.1.12 h1:PV8peI4a0ysnczrg+LtxykD8LfKY9ML6u2jnxaEnrnM=\n github.com/json-iterator/go v1.1.12/go.mod h1:e30LSqwooZae/UwlEbR2852Gd8hjQvJoHmT4TnhNGBo=\n github.com/jxskiss/base62 v1.1.0 h1:A5zbF8v8WXx2xixnAKD2w+abC+sIzYJX+nxmhA6HWFw=\n@@ -613,8 +613,8 @@ github.com/rivo/uniseg v0.4.7 h1:WUdvkW8uEhrYfLC4ZzdpI2ztxP1I582+49Oc5Mq64VQ=\n github.com/rivo/uniseg v0.4.7/go.mod h1:FN3SvrM+Zdj16jyLfmOkMNblXMcoc8DfTHruCPUcx88=\n github.com/rogpeppe/fastuuid v1.2.0/go.mod h1:jVj6XXZzXRy/MSR5jhDC/2q6DgLz+nrA6LYCDYWNEvQ=\n github.com/rogpeppe/go-internal v1.6.1/go.mod h1:xXDCJY+GAPziupqXw64V24skbSoqbTEfhy4qGm1nDQc=\n-github.com/rogpeppe/go-internal v1.12.0 h1:exVL4IDcn6na9z1rAb56Vxr+CgyK3nn3O+epU5NdKM8=\n-github.com/rogpeppe/go-internal v1.12.0/go.mod h1:E+RYuTGaKKdloAfM02xzb0FW3Paa99yedzYV+kq4uf4=\n+github.com/rogpeppe/go-internal v1.13.1 h1:KvO1DLK/DRN07sQ1LQKScxyZJuNnedQ5/wKSR38lUII=\n+github.com/rogpeppe/go-internal v1.13.1/go.mod h1:uMEvuHeurkdAXX61udpOXGD/AzZDWNMNyH2VO9fmH0o=\n github.com/rs/xid v1.6.0 h1:fV591PaemRlL6JfRxGDEPl69wICngIQ3shQtzfy2gxU=\n github.com/rs/xid v1.6.0/go.mod h1:7XoLgs4eV+QndskICGsho+ADou8ySMSjJKDIan90Nz0=\n github.com/russross/blackfriday/v2 v2.1.0 h1:JIOH55/0cWyOuilr9/qlrm0BSXldqnqwMsf35Ld67mk=\n@@ -645,8 +645,8 @@ github.com/siderolabs/go-api-signature v0.3.6 h1:wDIsXbpl7Oa/FXvxB6uz4VL9INA9fmr\n github.com/siderolabs/go-api-signature v0.3.6/go.mod h1:hoH13AfunHflxbXfh+NoploqV13ZTDfQ1mQJWNVSW9U=\n github.com/siderolabs/go-blockdevice v0.4.8 h1:KfdWvIx0Jft5YVuCsFIJFwjWEF1oqtzkgX9PeU9cX4c=\n github.com/siderolabs/go-blockdevice v0.4.8/go.mod h1:4PeOuk71pReJj1JQEXDE7kIIQJPVe8a+HZQa+qjxSEA=\n-github.com/siderolabs/go-blockdevice/v2 v2.0.6 h1:/NAy3MbNZhjLWo28asZyS/hmf86PEPDMc9i6wIcgbwI=\n-github.com/siderolabs/go-blockdevice/v2 v2.0.6/go.mod h1:74htzCV913UzaLZ4H+NBXkwWlYnBJIq5m/379ZEcu8w=\n+github.com/siderolabs/go-blockdevice/v2 v2.0.7 h1:OCxxA7W1xVqbEP3MrCttqhKpuV4t1KkBTzNeboYDTmc=\n+github.com/siderolabs/go-blockdevice/v2 v2.0.7/go.mod h1:74htzCV913UzaLZ4H+NBXkwWlYnBJIq5m/379ZEcu8w=\n github.com/siderolabs/go-circular v0.2.1 h1:a++iVCn9jyhICX3POQZZX8n72p2h5JGdGU6w1ulmpcA=\n github.com/siderolabs/go-circular v0.2.1/go.mod h1:ZDItzVyXK+B/XuqTBV5MtQtSv06VI+oCmWGRnNCATo8=\n github.com/siderolabs/go-cmd v0.1.3 h1:JrgZwqhJQeoec3QRON0LK+fv+0y7d0DyY7zsfkO6ciw=\n@@ -830,8 +830,8 @@ golang.org/x/crypto v0.0.0-20200622213623-75b288015ac9/go.mod h1:LzIPMQfyMNhhGPh\n golang.org/x/crypto v0.0.0-20210421170649-83a5a9bb288b/go.mod h1:T9bdIzuCu7OtxOm1hfPfRQxPLYneinmdGuTeoZ9dtd4=\n golang.org/x/crypto v0.0.0-20210921155107-089bfa567519/go.mod h1:GvvjBRRGRdwPK5ydBHafDWAxML/pGHZbMvKqRZ5+Abc=\n golang.org/x/crypto v0.0.0-20220722155217-630584e8d5aa/go.mod h1:IxCIyHEi3zRg3s0A5j5BB6A9Jmi73HwBIUl50j+osU4=\n-golang.org/x/crypto v0.29.0 h1:L5SG1JTTXupVV3n6sUqMTeWbjAyfPwoda2DLX8J8FrQ=\n-golang.org/x/crypto v0.29.0/go.mod h1:+F4F4N5hv6v38hfeYwTdx20oUvLLc+QfrE9Ax9HtgRg=\n+golang.org/x/crypto v0.30.0 h1:RwoQn3GkWiMkzlX562cLB7OxWvjH1L8xutO2WoJcRoY=\n+golang.org/x/crypto v0.30.0/go.mod h1:kDsLvtWBEx7MV9tJOj9bnXsPbxwJQ6csT/x4KIN4Ssk=\n golang.org/x/exp v0.0.0-20190121172915-509febef88a4/go.mod h1:CJ0aWSM057203Lf6IL+f9T1iT9GByDxfZKAQTCR3kQA=\n golang.org/x/exp v0.0.0-20241108190413-2d47ceb2692f h1:XdNn9LlyWAhLVp6P/i8QYBW+hlyhrhei9uErw2B5GJo=\n golang.org/x/exp v0.0.0-20241108190413-2d47ceb2692f/go.mod h1:D5SMRVC3C2/4+F/DB1wZsLRnSNimn2Sp/NPsCrsv8ak=\n@@ -880,8 +880,8 @@ golang.org/x/net v0.0.0-20211112202133-69e39bad7dc2/go.mod h1:9nx3DQGgdP8bBQD5qx\n golang.org/x/net v0.0.0-20220127200216-cd36cc0744dd/go.mod h1:CfG3xpIq0wQ8r1q4Su4UZFWDARRcnwPjda9FqA0JpMk=\n golang.org/x/net v0.0.0-20220722155237-a158d28d115b/go.mod h1:XRhObCWvk6IyKnWLug+ECip1KBveYUHfp+8e9klMJ9c=\n golang.org/x/net v0.6.0/go.mod h1:2Tu9+aMcznHK/AK1HMvgo6xiTLG5rD5rZLDS+rp2Bjs=\n-golang.org/x/net v0.31.0 h1:68CPQngjLL0r2AlUKiSxtQFKvzRVbnzLwMUn5SzcLHo=\n-golang.org/x/net v0.31.0/go.mod h1:P4fl1q7dY2hnZFxEk4pPSkDHF+QqjitcnDjUQyMM+pM=\n+golang.org/x/net v0.32.0 h1:ZqPmj8Kzc+Y6e0+skZsuACbx+wzMgo5MQsJh9Qd6aYI=\n+golang.org/x/net v0.32.0/go.mod h1:CwU0IoeOlnQQWJ6ioyFrfRuomB8GKF6KbYXZVyeXNfs=\n golang.org/x/oauth2 v0.0.0-20180821212333-d2e6202438be/go.mod h1:N/0e6XlmueqKjAGxoOufVs8QHGRruUQn6yWY3a++T0U=\n golang.org/x/oauth2 v0.0.0-20190604053449-0f29369cfe45/go.mod h1:gOpvHmFTYa4IltrdGE7lF6nIHvwfUNPOp7c8zoXwtLw=\n golang.org/x/oauth2 v0.0.0-20200107190931-bf48bf16ab8d/go.mod h1:gOpvHmFTYa4IltrdGE7lF6nIHvwfUNPOp7c8zoXwtLw=\n@@ -903,8 +903,8 @@ golang.org/x/sync v0.0.0-20201207232520-09787c993a3a/go.mod h1:RxMgew5VJxzue5/jJ\n golang.org/x/sync v0.0.0-20210220032951-036812b2e83c/go.mod h1:RxMgew5VJxzue5/jJTE5uejpjVlOe/izrB70Jof72aM=\n golang.org/x/sync v0.0.0-20220722155255-886fb9371eb4/go.mod h1:RxMgew5VJxzue5/jJTE5uejpjVlOe/izrB70Jof72aM=\n golang.org/x/sync v0.1.0/go.mod h1:RxMgew5VJxzue5/jJTE5uejpjVlOe/izrB70Jof72aM=\n-golang.org/x/sync v0.9.0 h1:fEo0HyrW1GIgZdpbhCRO0PkJajUS5H9IFUztCgEo2jQ=\n-golang.org/x/sync v0.9.0/go.mod h1:Czt+wKu1gCyEFDUtn0jG5QVvpJ6rzVqr5aXyt9drQfk=\n+golang.org/x/sync v0.10.0 h1:3NQrjDixjgGwUOCaF8w2+VYHv0Ve/vGYSbdkTa98gmQ=\n+golang.org/x/sync v0.10.0/go.mod h1:Czt+wKu1gCyEFDUtn0jG5QVvpJ6rzVqr5aXyt9drQfk=\n golang.org/x/sys v0.0.0-20180830151530-49385e6e1522/go.mod h1:STP8DvDyc/dI5b8T5hshtkjS+E42TnysNCUPdjciGhY=\n golang.org/x/sys v0.0.0-20190215142949-d0b11bdaac8a/go.mod h1:STP8DvDyc/dI5b8T5hshtkjS+E42TnysNCUPdjciGhY=\n golang.org/x/sys v0.0.0-20190312061237-fead79001313/go.mod h1:h1NjWce9XRLGQEsW7wpKNCjG9DtNlClVuFLEZdDNbEs=\n@@ -962,14 +962,15 @@ golang.org/x/sys v0.8.0/go.mod h1:oPkhp1MJrh7nUepCBck5+mAzfO9JrbApNNgaTdGDITg=\n golang.org/x/sys v0.10.0/go.mod h1:oPkhp1MJrh7nUepCBck5+mAzfO9JrbApNNgaTdGDITg=\n golang.org/x/sys v0.16.0/go.mod h1:/VUhepiaJMQUp4+oa/7Zr1D23ma6VTLIYjOOTFZPUcA=\n golang.org/x/sys v0.17.0/go.mod h1:/VUhepiaJMQUp4+oa/7Zr1D23ma6VTLIYjOOTFZPUcA=\n-golang.org/x/sys v0.27.0 h1:wBqf8DvsY9Y/2P8gAfPDEYNuS30J4lPHJxXSb/nJZ+s=\n golang.org/x/sys v0.27.0/go.mod h1:/VUhepiaJMQUp4+oa/7Zr1D23ma6VTLIYjOOTFZPUcA=\n+golang.org/x/sys v0.28.0 h1:Fksou7UEQUWlKvIdsqzJmUmCX3cZuD2+P3XyyzwMhlA=\n+golang.org/x/sys v0.28.0/go.mod h1:/VUhepiaJMQUp4+oa/7Zr1D23ma6VTLIYjOOTFZPUcA=\n golang.org/x/term v0.0.0-20201126162022-7de9c90e9dd1/go.mod h1:bj7SfCRtBDWHUb9snDiAeCFNEtKQo2Wmx5Cou7ajbmo=\n golang.org/x/term v0.0.0-20210927222741-03fcf44c2211/go.mod h1:jbD1KX2456YbFQfuXm/mYQcufACuNUgVhRMnK/tPxf8=\n golang.org/x/term v0.5.0/go.mod h1:jMB1sMXY+tzblOD4FWmEbocvup2/aLOaQEp7JmGp78k=\n golang.org/x/term v0.17.0/go.mod h1:lLRBjIVuehSbZlaOtGMbcMncT+aqLLLmKrsjNrUguwk=\n-golang.org/x/term v0.26.0 h1:WEQa6V3Gja/BhNxg540hBip/kkaYtRg3cxg4oXSw4AU=\n-golang.org/x/term v0.26.0/go.mod h1:Si5m1o57C5nBNQo5z1iq+XDijt21BDBDp2bK0QI8e3E=\n+golang.org/x/term v0.27.0 h1:WP60Sv1nlK1T6SupCHbXzSaN0b9wUmsPoRS9b61A23Q=\n+golang.org/x/term v0.27.0/go.mod h1:iMsnZpn0cago0GOrHO2+Y7u7JPn5AylBrcoWkElMTSM=\n golang.org/x/text v0.3.0/go.mod h1:NqM8EUOU14njkJ3fqMW+pc6Ldnwhi/IjpwHt7yyuwOQ=\n golang.org/x/text v0.3.2/go.mod h1:bEr9sfX3Q8Zfm5fL9x+3itogRgK3+ptLWKqgva+5dAk=\n golang.org/x/text v0.3.3/go.mod h1:5Zoc/QRtKVWzQhOtBMvqHzDpF6irO9z98xDceosuGiQ=\n@@ -979,8 +980,8 @@ golang.org/x/text v0.3.7/go.mod h1:u+2+/6zg+i71rQMx5EYifcz6MCKuco9NR6JIITiCfzQ=\n golang.org/x/text v0.7.0/go.mod h1:mrYo+phRRbMaCq/xk9113O4dZlRixOauAjOtrjsXDZ8=\n golang.org/x/text v0.8.0/go.mod h1:e1OnstbJyHTd6l/uOt8jFFHp6TRDWZR/bV3emEE/zU8=\n golang.org/x/text v0.14.0/go.mod h1:18ZOQIKpY8NJVqYksKHtTdi31H5itFRjB5/qKTNYzSU=\n-golang.org/x/text v0.20.0 h1:gK/Kv2otX8gz+wn7Rmb3vT96ZwuoxnQlY+HlJVj7Qug=\n-golang.org/x/text v0.20.0/go.mod h1:D4IsuqiFMhST5bX19pQ9ikHC2GsaKyk/oF+pn3ducp4=\n+golang.org/x/text v0.21.0 h1:zyQAAkrwaneQ066sspRyJaG9VNi/YJ1NfzcGB3hZ/qo=\n+golang.org/x/text v0.21.0/go.mod h1:4IBbMaMmOPCJ8SecivzSH54+73PCFmPWxNTLm+vZkEQ=\n golang.org/x/time v0.8.0 h1:9i3RxcPv3PZnitoVGMPDKZSq1xW1gK1Xy3ArNOGZfEg=\n golang.org/x/time v0.8.0/go.mod h1:3BpzKBy/shNhVucY/MWOyx10tF3SFh9QdLuxbVysPQM=\n golang.org/x/tools v0.0.0-20180917221912-90fa682c2a6e/go.mod h1:n7NCudcB/nEzxVGmLbDWY5pfWTLqBcC2KZ6jyYvM4mQ=\n@@ -1038,10 +1039,10 @@ google.golang.org/genproto v0.0.0-20210828152312-66f60bf46e71/go.mod h1:eFjDcFEc\n google.golang.org/genproto v0.0.0-20210909211513-a8c4777a87af/go.mod h1:eFjDcFEctNawg4eG61bRv87N7iHBWyVhJu7u1kqDUXY=\n google.golang.org/genproto v0.0.0-20211208223120-3a66f561d7aa/go.mod h1:5CzLGKJ67TSI2B9POpiiyGha0AjJvZIUgRMt1dSmuhc=\n google.golang.org/genproto v0.0.0-20211221195035-429b39de9b1c/go.mod h1:5CzLGKJ67TSI2B9POpiiyGha0AjJvZIUgRMt1dSmuhc=\n-google.golang.org/genproto/googleapis/api v0.0.0-20241118233622-e639e219e697 h1:pgr/4QbFyktUv9CtQ/Fq4gzEE6/Xs7iCXbktaGzLHbQ=\n-google.golang.org/genproto/googleapis/api v0.0.0-20241118233622-e639e219e697/go.mod h1:+D9ySVjN8nY8YCVjc5O7PZDIdZporIDY3KaGfJunh88=\n-google.golang.org/genproto/googleapis/rpc v0.0.0-20241118233622-e639e219e697 h1:LWZqQOEjDyONlF1H6afSWpAL/znlREo2tHfLoe+8LMA=\n-google.golang.org/genproto/googleapis/rpc v0.0.0-20241118233622-e639e219e697/go.mod h1:5uTbfoYQed2U9p3KIj2/Zzm02PYhndfdmML0qC3q3FU=\n+google.golang.org/genproto/googleapis/api v0.0.0-20241206012308-a4fef0638583 h1:v+j+5gpj0FopU0KKLDGfDo9ZRRpKdi5UBrCP0f76kuY=\n+google.golang.org/genproto/googleapis/api v0.0.0-20241206012308-a4fef0638583/go.mod h1:jehYqy3+AhJU9ve55aNOaSml7wUXjF9x6z2LcCfpAhY=\n+google.golang.org/genproto/googleapis/rpc v0.0.0-20241206012308-a4fef0638583 h1:IfdSdTcLFy4lqUQrQJLkLt1PB+AsqVz6lwkWPzWEz10=\n+google.golang.org/genproto/googleapis/rpc v0.0.0-20241206012308-a4fef0638583/go.mod h1:5uTbfoYQed2U9p3KIj2/Zzm02PYhndfdmML0qC3q3FU=\n google.golang.org/grpc v1.19.0/go.mod h1:mqu4LbDTu4XGKhr4mRzUsmM4RtVoemTSY81AxZiDr8c=\n google.golang.org/grpc v1.20.1/go.mod h1:10oTOabMzJvdu6/UiuZezV6QK5dSlG84ov/aaiqXj38=\n google.golang.org/grpc v1.21.1/go.mod h1:oYelfM1adQP15Ek0mdvEgi9Df8B9CZIaU1084ijfRaM=\n@@ -1058,8 +1059,8 @@ google.golang.org/grpc v1.39.0/go.mod h1:PImNr+rS9TWYb2O4/emRugxiyHZ5JyHW5F+RPnD\n google.golang.org/grpc v1.39.1/go.mod h1:PImNr+rS9TWYb2O4/emRugxiyHZ5JyHW5F+RPnDzfrE=\n google.golang.org/grpc v1.40.0/go.mod h1:ogyxbiOoUXAkP+4+xa6PZSE9DZgIHtSpzjDTB9KAK34=\n google.golang.org/grpc v1.40.1/go.mod h1:ogyxbiOoUXAkP+4+xa6PZSE9DZgIHtSpzjDTB9KAK34=\n-google.golang.org/grpc v1.68.0 h1:aHQeeJbo8zAkAa3pRzrVjZlbz6uSfeOXlJNQM0RAbz0=\n-google.golang.org/grpc v1.68.0/go.mod h1:fmSPC5AsjSBCK54MyHRx48kpOti1/jRfOlwEWywNjWA=\n+google.golang.org/grpc v1.68.1 h1:oI5oTa11+ng8r8XMMN7jAOmWfPZWbYpCFaMUTACxkM0=\n+google.golang.org/grpc v1.68.1/go.mod h1:+q1XYFJjShcqn0QZHvCyeR4CXPA+llXIeUIfIe00waw=\n google.golang.org/grpc/cmd/protoc-gen-go-grpc v1.1.0/go.mod h1:6Kw0yEErY5E/yWrBtf03jp27GLLJujG4z/JK95pnjjw=\n google.golang.org/protobuf v0.0.0-20200109180630-ec00e32a8dfd/go.mod h1:DFci5gLYBciE7Vtevhsrf46CRTquxDuWsQurQQe4oz8=\n google.golang.org/protobuf v0.0.0-20200221191635-4d8936d0db64/go.mod h1:kwYJMbMJ01Woi6D6+Kah6886xMZcty6N08ah7+eCXa0=\n@@ -1097,32 +1098,32 @@ gvisor.dev/gvisor v0.0.0-20240331093104-8c9cbf0d9090/go.mod h1:NQHVAzMwvZ+Qe3ElS\n honnef.co/go/tools v0.0.0-20190102054323-c2f93a96b099/go.mod h1:rf3lG4BRIbNafJWhAfAdb/ePZxsR/4RtNHQocxwk9r4=\n honnef.co/go/tools v0.0.0-20190418001031-e561f6794a2a/go.mod h1:rf3lG4BRIbNafJWhAfAdb/ePZxsR/4RtNHQocxwk9r4=\n honnef.co/go/tools v0.0.0-20190523083050-ea95bdfd59fc/go.mod h1:rf3lG4BRIbNafJWhAfAdb/ePZxsR/4RtNHQocxwk9r4=\n-k8s.io/api v0.32.0-rc.1 h1:dxXiVjLYq4JmlXFgctsK9zJaXhPA1hJLO772lHk4wKw=\n-k8s.io/api v0.32.0-rc.1/go.mod h1:3TNYUV1WB3ZF2yOeY4qlr9FDb1GVzO+OucsXW2BOi5o=\n-k8s.io/apimachinery v0.32.0-rc.1 h1:jeLQr/Dqcq0kGU/yjEmievDMHTJzzwQctlysW0Kb70U=\n-k8s.io/apimachinery v0.32.0-rc.1/go.mod h1:HqhdaJUgQqky29T1V0o2yFkt/pZqLFIDyn9Zi/8rxoY=\n-k8s.io/apiserver v0.32.0-rc.1 h1:zlrmW4wO1JYXlu4mHzQ/bQajC7OP/sgCRFF8abOWhEQ=\n-k8s.io/apiserver v0.32.0-rc.1/go.mod h1:kzVgA1c3Ig7wDnDF99bOz/dY4iEY/OWzayCY1gZPzDI=\n-k8s.io/cli-runtime v0.32.0-rc.1 h1:rQDtu2ihnv/ItkawGIewwqhgb6C6skVwNFWCxBx7loI=\n-k8s.io/cli-runtime v0.32.0-rc.1/go.mod h1:ifV1UrGAvsFhohEfFLkxoAAZPAXnp92ROioZvFG4be4=\n-k8s.io/client-go v0.32.0-rc.1 h1:ZW27sbQZ06FnkFTNqlfa9HTIW01RGoLoiOmdiLbWYK0=\n-k8s.io/client-go v0.32.0-rc.1/go.mod h1:Nlv9GR11bKYSlCcxY3B1RpVbcsfasSAwminv42knDHk=\n-k8s.io/component-base v0.32.0-rc.1 h1:c3EG8QuyozbalRmbsUxXW/ZmF2bev3Zq9PbpU3oIHT4=\n-k8s.io/component-base v0.32.0-rc.1/go.mod h1:xIvfPkeLsQbd2fkDNWezG20WQwrabBetTUxp67eycbI=\n-k8s.io/cri-api v0.32.0-rc.1 h1:e7+u84qR9Nychp2imSIIDeQSNBZut/1alF7vcskZbik=\n-k8s.io/cri-api v0.32.0-rc.1/go.mod h1:5WOp91NVV2mzTQRp732avavhFFItsWsQy8jO7DPv8d8=\n+k8s.io/api v0.32.0 h1:OL9JpbvAU5ny9ga2fb24X8H6xQlVp+aJMFlgtQjR9CE=\n+k8s.io/api v0.32.0/go.mod h1:4LEwHZEf6Q/cG96F3dqR965sYOfmPM7rq81BLgsE0p0=\n+k8s.io/apimachinery v0.32.0 h1:cFSE7N3rmEEtv4ei5X6DaJPHHX0C+upp+v5lVPiEwpg=\n+k8s.io/apimachinery v0.32.0/go.mod h1:GpHVgxoKlTxClKcteaeuF1Ul/lDVb74KpZcxcmLDElE=\n+k8s.io/apiserver v0.32.0 h1:VJ89ZvQZ8p1sLeiWdRJpRD6oLozNZD2+qVSLi+ft5Qs=\n+k8s.io/apiserver v0.32.0/go.mod h1:HFh+dM1/BE/Hm4bS4nTXHVfN6Z6tFIZPi649n83b4Ag=\n+k8s.io/cli-runtime v0.32.0 h1:dP+OZqs7zHPpGQMCGAhectbHU2SNCuZtIimRKTv2T1c=\n+k8s.io/cli-runtime v0.32.0/go.mod h1:Mai8ht2+esoDRK5hr861KRy6z0zHsSTYttNVJXgP3YQ=\n+k8s.io/client-go v0.32.0 h1:DimtMcnN/JIKZcrSrstiwvvZvLjG0aSxy8PxN8IChp8=\n+k8s.io/client-go v0.32.0/go.mod h1:boDWvdM1Drk4NJj/VddSLnx59X3OPgwrOo0vGbtq9+8=\n+k8s.io/component-base v0.32.0 h1:d6cWHZkCiiep41ObYQS6IcgzOUQUNpywm39KVYaUqzU=\n+k8s.io/component-base v0.32.0/go.mod h1:JLG2W5TUxUu5uDyKiH2R/7NnxJo1HlPoRIIbVLkK5eM=\n+k8s.io/cri-api v0.32.0 h1:pzXJfyG7Tm4acrEt5HPqAq3r4cN5guLeapAN/NM2b70=\n+k8s.io/cri-api v0.32.0/go.mod h1:DCzMuTh2padoinefWME0G678Mc3QFbLMF2vEweGzBAI=\n k8s.io/klog/v2 v2.130.1 h1:n9Xl7H1Xvksem4KFG4PYbdQCQxqc/tTUyrgXaOhHSzk=\n k8s.io/klog/v2 v2.130.1/go.mod h1:3Jpz1GvMt720eyJH1ckRHK1EDfpxISzJ7I9OYgaDtPE=\n k8s.io/kube-openapi v0.0.0-20241105132330-32ad38e42d3f h1:GA7//TjRY9yWGy1poLzYYJJ4JRdzg3+O6e8I+e+8T5Y=\n k8s.io/kube-openapi v0.0.0-20241105132330-32ad38e42d3f/go.mod h1:R/HEjbvWI0qdfb8viZUeVZm0X6IZnxAydC7YU42CMw4=\n-k8s.io/kube-scheduler v0.32.0-rc.1 h1:TrCQMuOZthP7POY+wQgPZoXQ9+wJeHZNsCbeqO26jGw=\n-k8s.io/kube-scheduler v0.32.0-rc.1/go.mod h1:SjsaRjg/7iyItYvxkKaSaTvSQNnIbXwBMYSjrp+8ZhY=\n-k8s.io/kubectl v0.32.0-rc.1 h1:hkZ9bqMyOySj8Ky8d6/Yjxa7WQBJKijaMTcGkYmYYKE=\n-k8s.io/kubectl v0.32.0-rc.1/go.mod h1:+N+xgO48ssPu8eJMm2rymUuMIDy2UgqY67Xj/p5eO0Y=\n-k8s.io/kubelet v0.32.0-rc.1 h1:vgQavYPMnDlOAECm3ApeKWrU3m7Oo2lQuGtviJ00jSA=\n-k8s.io/kubelet v0.32.0-rc.1/go.mod h1:lkKQv20UU5m23z4DKYOUbe+j3BMnhRpALR2rqDtduBo=\n-k8s.io/pod-security-admission v0.32.0-rc.1 h1:hinSdeNwLTmuyQpUaZjAPgQjSzIKfu8vo4MFPwV2uKE=\n-k8s.io/pod-security-admission v0.32.0-rc.1/go.mod h1:kMQk2qV2sdGCXMRITdPNy4dAZ9qqcbLgdkzgj/C+niM=\n+k8s.io/kube-scheduler v0.32.0 h1:FCsF/3TPvR51ptx/gLUrqcoKqAMhQKrydYCJzPz9VGM=\n+k8s.io/kube-scheduler v0.32.0/go.mod h1:yof3vmyx70TWoQ6XZruYEGIUT/r0H/ELGdnWiqPF5EE=\n+k8s.io/kubectl v0.32.0 h1:rpxl+ng9qeG79YA4Em9tLSfX0G8W0vfaiPVrc/WR7Xw=\n+k8s.io/kubectl v0.32.0/go.mod h1:qIjSX+QgPQUgdy8ps6eKsYNF+YmFOAO3WygfucIqFiE=\n+k8s.io/kubelet v0.32.0 h1:uLyiKlz195Wo4an/K2tyge8o3QHx0ZkhVN3pevvp59A=\n+k8s.io/kubelet v0.32.0/go.mod h1:lAwuVZT/Hm7EdLn0jW2D+WdrJoorjJL2rVSdhOFnegw=\n+k8s.io/pod-security-admission v0.32.0 h1:I+Og0uZIiMpIgTgPrTbW4jlwRI5RWazi8y+jrx1v10w=\n+k8s.io/pod-security-admission v0.32.0/go.mod h1:RvrcY0+5UAoCIJ7BscgDF3nbmXprgfnjTW+byCyXDvA=\n k8s.io/utils v0.0.0-20241104100929-3ea5e8cea738 h1:M3sRQVHv7vB20Xc2ybTt7ODCeFj6JSWYFzOFnYeS6Ro=\n k8s.io/utils v0.0.0-20241104100929-3ea5e8cea738/go.mod h1:OLgZIPagt7ERELqWJFomSt595RzquPNLL48iOWgYOg0=\n kernel.org/pub/linux/libs/security/libcap/cap v1.2.72 h1:SqLZbTqwcNxctcdM5yb6OcO3lFJNtRgDJoFeca+5hP0="
    },
    {
      "filename": "hack/release.toml",
      "status": "modified",
      "patch": "@@ -18,11 +18,11 @@ preface = \"\"\"\n     [notes.updates]\n         title = \"Component Updates\"\n         description = \"\"\"\\\n-* Linux: 6.12.4\n-* containerd: 2.0.0\n+* Linux: 6.12.5\n+* containerd: 2.0.1\n * Flannel: 0.26.1\n-* Kubernetes: 1.32.0-rc.1\n-* runc: 1.2.1\n+* Kubernetes: 1.32.0\n+* runc: 1.2.3\n * CoreDNS: 1.12.0\n \n Talos is built with Go 1.23.4.\n@@ -174,6 +174,7 @@ It can be enabled with the following config patch:\n machine:\n   features:\n     nodeAddressSortAlgorithm: v2\n+```\n \"\"\"\n \n [make_deps]"
    },
    {
      "filename": "hack/test/e2e.sh",
      "status": "modified",
      "patch": "@@ -33,7 +33,7 @@ export TALOS_VERSION\n # Kubernetes\n \n export KUBECONFIG=\"${TMP}/kubeconfig\"\n-export KUBERNETES_VERSION=${KUBERNETES_VERSION:-1.32.0-rc.1}\n+export KUBERNETES_VERSION=${KUBERNETES_VERSION:-1.32.0}\n \n export NAME_PREFIX=\"talos-e2e-${SHA}-${PLATFORM}\"\n export TIMEOUT=1200"
    },
    {
      "filename": "hack/test/patches/ephemeral-min-max.yaml",
      "status": "added",
      "patch": "@@ -0,0 +1,8 @@\n+apiVersion: v1alpha1\n+kind: VolumeConfig\n+name: EPHEMERAL\n+provisioning:\n+  diskSelector:\n+    match: system_disk\n+  minSize: 4GB\n+  maxSize: 100GB"
    },
    {
      "filename": "internal/app/machined/pkg/controllers/block/internal/volumes/format.go",
      "status": "modified",
      "patch": "@@ -30,7 +30,7 @@ func Format(ctx context.Context, logger *zap.Logger, volumeContext ManagerContex\n \t\tdevPath = volumeContext.Status.Location\n \t}\n \n-\tdev, err := blockdev.NewFromPath(devPath, blockdev.OpenForWrite())\n+\tdev, err := blockdev.NewFromPath(devPath)\n \tif err != nil {\n \t\treturn xerrors.NewTaggedf[Retryable](\"error opening disk: %w\", err)\n \t}"
    },
    {
      "filename": "internal/app/machined/pkg/controllers/block/internal/volumes/volumes.go",
      "status": "modified",
      "patch": "@@ -8,6 +8,7 @@ package volumes\n import (\n \t\"cmp\"\n \t\"context\"\n+\t\"math\"\n \n \t\"github.com/siderolabs/gen/optional\"\n \n@@ -18,11 +19,29 @@ import (\n \n // CompareVolumeConfigs compares two volume configs in the proposed order of provisioning.\n func CompareVolumeConfigs(a, b *block.VolumeConfig) int {\n+\t// first, sort by wave, smaller wave first\n \tif c := cmp.Compare(a.TypedSpec().Provisioning.Wave, b.TypedSpec().Provisioning.Wave); c != 0 {\n \t\treturn c\n \t}\n \n-\treturn cmpBool(a.TypedSpec().Provisioning.PartitionSpec.Grow, b.TypedSpec().Provisioning.PartitionSpec.Grow)\n+\t// prefer partitions which do not grow, as growing partitions may consume space needed by other partitions\n+\tif c := cmpBool(a.TypedSpec().Provisioning.PartitionSpec.Grow, b.TypedSpec().Provisioning.PartitionSpec.Grow); c != 0 {\n+\t\treturn c\n+\t}\n+\n+\t// prefer partitions with smaller sizes first\n+\t// e.g.: for a disk of size 1GiB, and following config with min-max requested sizes:\n+\t// 1. 100MiB - 200MiB\n+\t// 2. 300MiB - 2GiB\n+\t//\n+\t// if the order is 2-1, the second partition will grow to full disk size and will leave no space for the first partition,\n+\t// but if the order is 1-2, partition sizes will 200MiB and 800MiB respectively.\n+\t//\n+\t// we compare only max size, as it affects the resulting size of the partition\n+\tdesiredSizeA := cmp.Or(a.TypedSpec().Provisioning.PartitionSpec.MaxSize, math.MaxUint64)\n+\tdesiredSizeB := cmp.Or(b.TypedSpec().Provisioning.PartitionSpec.MaxSize, math.MaxUint64)\n+\n+\treturn cmp.Compare(desiredSizeA, desiredSizeB)\n }\n \n func cmpBool(a, b bool) int {"
    },
    {
      "filename": "internal/app/machined/pkg/controllers/block/internal/volumes/volumes_test.go",
      "status": "added",
      "patch": "@@ -0,0 +1,132 @@\n+// This Source Code Form is subject to the terms of the Mozilla Public\n+// License, v. 2.0. If a copy of the MPL was not distributed with this\n+// file, You can obtain one at http://mozilla.org/MPL/2.0/.\n+\n+package volumes_test\n+\n+import (\n+\t\"testing\"\n+\n+\t\"github.com/stretchr/testify/assert\"\n+\n+\t\"github.com/siderolabs/talos/internal/app/machined/pkg/controllers/block/internal/volumes\"\n+\t\"github.com/siderolabs/talos/pkg/machinery/resources/block\"\n+)\n+\n+func TestCompareVolumeConfigs(t *testing.T) {\n+\tt.Parallel()\n+\n+\tfor _, test := range []struct {\n+\t\tname string\n+\n+\t\ta *block.VolumeConfigSpec\n+\t\tb *block.VolumeConfigSpec\n+\n+\t\texpected int\n+\t}{\n+\t\t{\n+\t\t\tname: \"different wave\",\n+\n+\t\t\ta: &block.VolumeConfigSpec{\n+\t\t\t\tProvisioning: block.ProvisioningSpec{\n+\t\t\t\t\tWave: block.WaveSystemDisk,\n+\t\t\t\t},\n+\t\t\t},\n+\t\t\tb: &block.VolumeConfigSpec{\n+\t\t\t\tProvisioning: block.ProvisioningSpec{\n+\t\t\t\t\tWave: block.WaveUserDisks,\n+\t\t\t\t},\n+\t\t\t},\n+\n+\t\t\texpected: -1,\n+\t\t},\n+\t\t{\n+\t\t\tname: \"prefer grow\",\n+\n+\t\t\ta: &block.VolumeConfigSpec{\n+\t\t\t\tProvisioning: block.ProvisioningSpec{\n+\t\t\t\t\tWave: block.WaveSystemDisk,\n+\t\t\t\t\tPartitionSpec: block.PartitionSpec{\n+\t\t\t\t\t\tGrow: true,\n+\t\t\t\t\t},\n+\t\t\t\t},\n+\t\t\t},\n+\t\t\tb: &block.VolumeConfigSpec{\n+\t\t\t\tProvisioning: block.ProvisioningSpec{\n+\t\t\t\t\tWave: block.WaveSystemDisk,\n+\t\t\t\t\tPartitionSpec: block.PartitionSpec{\n+\t\t\t\t\t\tGrow: false,\n+\t\t\t\t\t},\n+\t\t\t\t},\n+\t\t\t},\n+\n+\t\t\texpected: 1,\n+\t\t},\n+\t\t{\n+\t\t\tname: \"prefer smaller size\",\n+\n+\t\t\ta: &block.VolumeConfigSpec{\n+\t\t\t\tProvisioning: block.ProvisioningSpec{\n+\t\t\t\t\tWave: block.WaveSystemDisk,\n+\t\t\t\t\tPartitionSpec: block.PartitionSpec{\n+\t\t\t\t\t\tGrow:    false,\n+\t\t\t\t\t\tMinSize: 100,\n+\t\t\t\t\t\tMaxSize: 200,\n+\t\t\t\t\t},\n+\t\t\t\t},\n+\t\t\t},\n+\t\t\tb: &block.VolumeConfigSpec{\n+\t\t\t\tProvisioning: block.ProvisioningSpec{\n+\t\t\t\t\tWave: block.WaveSystemDisk,\n+\t\t\t\t\tPartitionSpec: block.PartitionSpec{\n+\t\t\t\t\t\tGrow:    false,\n+\t\t\t\t\t\tMinSize: 150,\n+\t\t\t\t\t\tMaxSize: 1000,\n+\t\t\t\t\t},\n+\t\t\t\t},\n+\t\t\t},\n+\n+\t\t\texpected: -1,\n+\t\t},\n+\t\t{\n+\t\t\tname: \"prefer max size\",\n+\n+\t\t\ta: &block.VolumeConfigSpec{\n+\t\t\t\tProvisioning: block.ProvisioningSpec{\n+\t\t\t\t\tWave: block.WaveSystemDisk,\n+\t\t\t\t\tPartitionSpec: block.PartitionSpec{\n+\t\t\t\t\t\tGrow:    false,\n+\t\t\t\t\t\tMinSize: 100,\n+\t\t\t\t\t\tMaxSize: 200,\n+\t\t\t\t\t},\n+\t\t\t\t},\n+\t\t\t},\n+\t\t\tb: &block.VolumeConfigSpec{\n+\t\t\t\tProvisioning: block.ProvisioningSpec{\n+\t\t\t\t\tWave: block.WaveSystemDisk,\n+\t\t\t\t\tPartitionSpec: block.PartitionSpec{\n+\t\t\t\t\t\tGrow:    false,\n+\t\t\t\t\t\tMinSize: 50,\n+\t\t\t\t\t\tMaxSize: 0, // no limit\n+\t\t\t\t\t},\n+\t\t\t\t},\n+\t\t\t},\n+\n+\t\t\texpected: -1,\n+\t\t},\n+\t} {\n+\t\tt.Run(test.name, func(t *testing.T) {\n+\t\t\tt.Parallel()\n+\n+\t\t\tresA := block.NewVolumeConfig(block.NamespaceName, \"A\")\n+\t\t\t*resA.TypedSpec() = *test.a\n+\n+\t\t\tresB := block.NewVolumeConfig(block.NamespaceName, \"B\")\n+\t\t\t*resB.TypedSpec() = *test.b\n+\n+\t\t\tactual := volumes.CompareVolumeConfigs(resA, resB)\n+\n+\t\t\tassert.Equal(t, test.expected, actual)\n+\t\t})\n+\t}\n+}"
    },
    {
      "filename": "internal/app/machined/pkg/controllers/block/volume_manager.go",
      "status": "modified",
      "patch": "@@ -346,7 +346,28 @@ func (ctrl *VolumeManagerController) Run(ctx context.Context, r controller.Runti\n \t\t\t}\n \n \t\t\tif prevPhase != volumeStatus.Phase || err != nil {\n-\t\t\t\tvolumeLogger.Info(\"volume status\", zap.String(\"phase\", fmt.Sprintf(\"%s -> %s\", prevPhase, volumeStatus.Phase)), zap.Error(err))\n+\t\t\t\tfields := []zap.Field{\n+\t\t\t\t\tzap.String(\"phase\", fmt.Sprintf(\"%s -> %s\", prevPhase, volumeStatus.Phase)),\n+\t\t\t\t\tzap.Error(err),\n+\t\t\t\t}\n+\n+\t\t\t\tif volumeStatus.Location != \"\" {\n+\t\t\t\t\tfields = append(fields, zap.String(\"location\", volumeStatus.Location))\n+\t\t\t\t}\n+\n+\t\t\t\tif volumeStatus.MountLocation != \"\" && volumeStatus.MountLocation != volumeStatus.Location {\n+\t\t\t\t\tfields = append(fields, zap.String(\"mountLocation\", volumeStatus.MountLocation))\n+\t\t\t\t}\n+\n+\t\t\t\tif volumeStatus.ParentLocation != \"\" {\n+\t\t\t\t\tfields = append(fields, zap.String(\"parentLocation\", volumeStatus.ParentLocation))\n+\t\t\t\t}\n+\n+\t\t\t\tif len(volumeStatus.EncryptionFailedSyncs) > 0 {\n+\t\t\t\t\tfields = append(fields, zap.Strings(\"encryptionFailedSyncs\", volumeStatus.EncryptionFailedSyncs))\n+\t\t\t\t}\n+\n+\t\t\t\tvolumeLogger.Info(\"volume status\", fields...)\n \t\t\t}\n \n \t\t\tallClosed = allClosed && volumeStatus.Phase == block.VolumePhaseClosed"
    },
    {
      "filename": "internal/app/machined/pkg/controllers/cri/image_cache_config.go",
      "status": "modified",
      "patch": "@@ -16,6 +16,7 @@ import (\n \t\"github.com/cosi-project/runtime/pkg/safe\"\n \t\"github.com/cosi-project/runtime/pkg/state\"\n \t\"github.com/dustin/go-humanize\"\n+\t\"github.com/google/cel-go/common/ast\"\n \t\"github.com/google/cel-go/common/operators\"\n \t\"github.com/google/cel-go/common/types\"\n \t\"github.com/siderolabs/gen/optional\"\n@@ -198,19 +199,26 @@ func (ctrl *ImageCacheConfigController) Run(ctx context.Context, r controller.Ru\n func (ctrl *ImageCacheConfigController) createVolumeConfigISO(ctx context.Context, r controller.ReaderWriter) error {\n \tbuilder := cel.NewBuilder(celenv.VolumeLocator())\n \n-\t// volume.name == \"iso9660\" && volume.label.startsWith(\"TALOS_\")\n+\t// volume.name in [\"iso9660\", \"vfat\"] && volume.label.startsWith(\"TALOS_\")\n \texpr := builder.NewCall(\n \t\tbuilder.NextID(),\n \t\toperators.LogicalAnd,\n \t\tbuilder.NewCall(\n \t\t\tbuilder.NextID(),\n-\t\t\toperators.Equals,\n+\t\t\toperators.In,\n \t\t\tbuilder.NewSelect(\n \t\t\t\tbuilder.NextID(),\n \t\t\t\tbuilder.NewIdent(builder.NextID(), \"volume\"),\n \t\t\t\t\"name\",\n \t\t\t),\n-\t\t\tbuilder.NewLiteral(builder.NextID(), types.String(\"iso9660\")),\n+\t\t\tbuilder.NewList(\n+\t\t\t\tbuilder.NextID(),\n+\t\t\t\t[]ast.Expr{\n+\t\t\t\t\tbuilder.NewLiteral(builder.NextID(), types.String(\"iso9660\")),\n+\t\t\t\t\tbuilder.NewLiteral(builder.NextID(), types.String(\"vfat\")),\n+\t\t\t\t},\n+\t\t\t\tnil,\n+\t\t\t),\n \t\t),\n \t\tbuilder.NewMemberCall(\n \t\t\tbuilder.NextID(),"
    },
    {
      "filename": "internal/app/machined/pkg/controllers/cri/image_cache_config_test.go",
      "status": "modified",
      "patch": "@@ -63,7 +63,7 @@ func (suite *ImageCacheConfigSuite) TestReconcileFeatureEnabled() {\n \tsuite.Require().NoError(suite.State().Create(suite.Ctx(), cfg))\n \n \tctest.AssertResource(suite, crictrl.VolumeImageCacheISO, func(r *block.VolumeConfig, asrt *assert.Assertions) {\n-\t\tasrt.Equal(`volume.name == \"iso9660\" && volume.label.startsWith(\"TALOS_\")`, r.TypedSpec().Locator.Match.String())\n+\t\tasrt.Equal(`volume.name in [\"iso9660\", \"vfat\"] && volume.label.startsWith(\"TALOS_\")`, r.TypedSpec().Locator.Match.String())\n \t})\n \tctest.AssertResource(suite, crictrl.VolumeImageCacheDISK, func(r *block.VolumeConfig, asrt *assert.Assertions) {\n \t\tasrt.Equal(`volume.partition_label == \"IMAGECACHE\"`, r.TypedSpec().Locator.Match.String())"
    },
    {
      "filename": "internal/app/machined/pkg/controllers/cri/registries_config.go",
      "status": "modified",
      "patch": "@@ -15,6 +15,7 @@ import (\n \t\"github.com/siderolabs/gen/optional\"\n \t\"go.uber.org/zap\"\n \n+\t\"github.com/siderolabs/talos/pkg/machinery/config/types/v1alpha1\"\n \t\"github.com/siderolabs/talos/pkg/machinery/constants\"\n \t\"github.com/siderolabs/talos/pkg/machinery/resources/config\"\n \t\"github.com/siderolabs/talos/pkg/machinery/resources/cri\"\n@@ -54,19 +55,7 @@ func NewRegistriesConfigController() *RegistriesConfigController {\n \t\t\t\t\tmr := cfg.Provider().RawV1Alpha1().MachineConfig.MachineRegistries\n \n \t\t\t\t\tfor k, v := range mr.RegistryConfig {\n-\t\t\t\t\t\tspec.RegistryConfig[k] = &cri.RegistryConfig{\n-\t\t\t\t\t\t\tRegistryTLS: &cri.RegistryTLSConfig{\n-\t\t\t\t\t\t\t\tTLSClientIdentity:     v.RegistryTLS.TLSClientIdentity,\n-\t\t\t\t\t\t\t\tTLSCA:                 v.RegistryTLS.TLSCA,\n-\t\t\t\t\t\t\t\tTLSInsecureSkipVerify: v.RegistryTLS.TLSInsecureSkipVerify,\n-\t\t\t\t\t\t\t},\n-\t\t\t\t\t\t\tRegistryAuth: &cri.RegistryAuthConfig{\n-\t\t\t\t\t\t\t\tRegistryUsername:      v.RegistryAuth.RegistryUsername,\n-\t\t\t\t\t\t\t\tRegistryPassword:      v.RegistryAuth.RegistryPassword,\n-\t\t\t\t\t\t\t\tRegistryAuth:          v.RegistryAuth.RegistryAuth,\n-\t\t\t\t\t\t\t\tRegistryIdentityToken: v.RegistryAuth.RegistryIdentityToken,\n-\t\t\t\t\t\t\t},\n-\t\t\t\t\t\t}\n+\t\t\t\t\t\tspec.RegistryConfig[k] = makeRegistryConfig(v)\n \t\t\t\t\t}\n \n \t\t\t\t\tfor k, v := range mr.RegistryMirrors {\n@@ -116,3 +105,26 @@ func clearInit[M ~map[K]V, K comparable, V any](m M) M {\n \n \treturn m\n }\n+\n+func makeRegistryConfig(cfg *v1alpha1.RegistryConfig) *cri.RegistryConfig {\n+\tresult := &cri.RegistryConfig{}\n+\n+\tif rtls := cfg.RegistryTLS; rtls != nil {\n+\t\tresult.RegistryTLS = &cri.RegistryTLSConfig{\n+\t\t\tTLSClientIdentity:     rtls.TLSClientIdentity,\n+\t\t\tTLSCA:                 rtls.TLSCA,\n+\t\t\tTLSInsecureSkipVerify: rtls.TLSInsecureSkipVerify,\n+\t\t}\n+\t}\n+\n+\tif rauth := cfg.RegistryAuth; rauth != nil {\n+\t\tresult.RegistryAuth = &cri.RegistryAuthConfig{\n+\t\t\tRegistryUsername:      rauth.RegistryUsername,\n+\t\t\tRegistryPassword:      rauth.RegistryPassword,\n+\t\t\tRegistryAuth:          rauth.RegistryAuth,\n+\t\t\tRegistryIdentityToken: rauth.RegistryIdentityToken,\n+\t\t}\n+\t}\n+\n+\treturn result\n+}"
    },
    {
      "filename": "internal/app/machined/pkg/controllers/cri/registries_config_test.go",
      "status": "modified",
      "patch": "@@ -8,6 +8,7 @@ import (\n \t\"testing\"\n \t\"time\"\n \n+\t\"github.com/siderolabs/go-pointer\"\n \t\"github.com/stretchr/testify/assert\"\n \t\"github.com/stretchr/testify/suite\"\n \n@@ -74,6 +75,173 @@ func (suite *ConfigSuite) TestRegistry() {\n \t})\n }\n \n+func (suite *ConfigSuite) TestRegistryAuth() {\n+\tcfg := config.NewMachineConfig(container.NewV1Alpha1(&v1alpha1.Config{\n+\t\tConfigVersion: \"v1alpha1\",\n+\t\tMachineConfig: &v1alpha1.MachineConfig{\n+\t\t\tMachineType: \"controlplane\",\n+\t\t\tMachineRegistries: v1alpha1.RegistriesConfig{\n+\t\t\t\tRegistryMirrors: map[string]*v1alpha1.RegistryMirrorConfig{\n+\t\t\t\t\t\"docker.io\": {MirrorEndpoints: []string{\"https://mirror.io\"}},\n+\t\t\t\t},\n+\t\t\t\tRegistryConfig: map[string]*v1alpha1.RegistryConfig{\n+\t\t\t\t\t\"docker.io\": {\n+\t\t\t\t\t\tRegistryAuth: &v1alpha1.RegistryAuthConfig{\n+\t\t\t\t\t\t\tRegistryUsername:      \"example\",\n+\t\t\t\t\t\t\tRegistryPassword:      \"pass\",\n+\t\t\t\t\t\t\tRegistryAuth:          \"someauth\",\n+\t\t\t\t\t\t\tRegistryIdentityToken: \"token\",\n+\t\t\t\t\t\t},\n+\t\t\t\t\t},\n+\t\t\t\t},\n+\t\t\t},\n+\t\t},\n+\t}))\n+\n+\tsuite.Require().NoError(suite.State().Create(suite.Ctx(), cfg))\n+\n+\tctest.AssertResource(suite, crires.RegistriesConfigID, func(r *crires.RegistriesConfig, a *assert.Assertions) {\n+\t\tspec := r.TypedSpec()\n+\n+\t\ta.Equal(\n+\t\t\tmap[string]*crires.RegistryMirrorConfig{\n+\t\t\t\t\"docker.io\": {MirrorEndpoints: []string{\"https://mirror.io\"}},\n+\t\t\t},\n+\t\t\tspec.RegistryMirrors,\n+\t\t)\n+\n+\t\ta.Equal(\n+\t\t\tmap[string]*crires.RegistryConfig{\n+\t\t\t\t\"docker.io\": {\n+\t\t\t\t\tRegistryAuth: &crires.RegistryAuthConfig{\n+\t\t\t\t\t\tRegistryUsername:      \"example\",\n+\t\t\t\t\t\tRegistryPassword:      \"pass\",\n+\t\t\t\t\t\tRegistryAuth:          \"someauth\",\n+\t\t\t\t\t\tRegistryIdentityToken: \"token\",\n+\t\t\t\t\t},\n+\t\t\t\t},\n+\t\t\t},\n+\t\t\tspec.RegistryConfig,\n+\t\t)\n+\t})\n+\n+\tic := crires.NewImageCacheConfig()\n+\tic.TypedSpec().Roots = []string{\"/imagecache\"}\n+\tic.TypedSpec().Status = crires.ImageCacheStatusReady\n+\n+\tsuite.Require().NoError(suite.State().Create(suite.Ctx(), ic))\n+\n+\tctest.AssertResource(suite, crires.RegistriesConfigID, func(r *crires.RegistriesConfig, a *assert.Assertions) {\n+\t\tspec := r.TypedSpec()\n+\n+\t\ta.Equal(\n+\t\t\tmap[string]*crires.RegistryMirrorConfig{\n+\t\t\t\t\"*\": {MirrorEndpoints: []string{\n+\t\t\t\t\t\"http://\" + constants.RegistrydListenAddress,\n+\t\t\t\t}},\n+\t\t\t\t\"docker.io\": {MirrorEndpoints: []string{\n+\t\t\t\t\t\"http://\" + constants.RegistrydListenAddress,\n+\t\t\t\t\t\"https://mirror.io\",\n+\t\t\t\t}},\n+\t\t\t},\n+\t\t\tspec.RegistryMirrors,\n+\t\t)\n+\n+\t\ta.Equal(\n+\t\t\tmap[string]*crires.RegistryConfig{\n+\t\t\t\t\"docker.io\": {\n+\t\t\t\t\tRegistryAuth: &crires.RegistryAuthConfig{\n+\t\t\t\t\t\tRegistryUsername:      \"example\",\n+\t\t\t\t\t\tRegistryPassword:      \"pass\",\n+\t\t\t\t\t\tRegistryAuth:          \"someauth\",\n+\t\t\t\t\t\tRegistryIdentityToken: \"token\",\n+\t\t\t\t\t},\n+\t\t\t\t},\n+\t\t\t},\n+\t\t\tspec.RegistryConfig,\n+\t\t)\n+\t})\n+}\n+\n+func (suite *ConfigSuite) TestRegistryTLS() {\n+\tcfg := config.NewMachineConfig(container.NewV1Alpha1(&v1alpha1.Config{\n+\t\tConfigVersion: \"v1alpha1\",\n+\t\tMachineConfig: &v1alpha1.MachineConfig{\n+\t\t\tMachineType: \"controlplane\",\n+\t\t\tMachineRegistries: v1alpha1.RegistriesConfig{\n+\t\t\t\tRegistryMirrors: map[string]*v1alpha1.RegistryMirrorConfig{\n+\t\t\t\t\t\"docker.io\": {MirrorEndpoints: []string{\"https://mirror.io\"}},\n+\t\t\t\t},\n+\t\t\t\tRegistryConfig: map[string]*v1alpha1.RegistryConfig{\n+\t\t\t\t\t\"docker.io\": {\n+\t\t\t\t\t\tRegistryTLS: &v1alpha1.RegistryTLSConfig{\n+\t\t\t\t\t\t\tTLSInsecureSkipVerify: pointer.To(true),\n+\t\t\t\t\t\t},\n+\t\t\t\t\t},\n+\t\t\t\t},\n+\t\t\t},\n+\t\t},\n+\t}))\n+\n+\tsuite.Require().NoError(suite.State().Create(suite.Ctx(), cfg))\n+\n+\tctest.AssertResource(suite, crires.RegistriesConfigID, func(r *crires.RegistriesConfig, a *assert.Assertions) {\n+\t\tspec := r.TypedSpec()\n+\n+\t\ta.Equal(\n+\t\t\tmap[string]*crires.RegistryMirrorConfig{\n+\t\t\t\t\"docker.io\": {MirrorEndpoints: []string{\"https://mirror.io\"}},\n+\t\t\t},\n+\t\t\tspec.RegistryMirrors,\n+\t\t)\n+\n+\t\ta.Equal(\n+\t\t\tmap[string]*crires.RegistryConfig{\n+\t\t\t\t\"docker.io\": {\n+\t\t\t\t\tRegistryTLS: &crires.RegistryTLSConfig{\n+\t\t\t\t\t\tTLSInsecureSkipVerify: pointer.To(true),\n+\t\t\t\t\t},\n+\t\t\t\t},\n+\t\t\t},\n+\t\t\tspec.RegistryConfig,\n+\t\t)\n+\t})\n+\n+\tic := crires.NewImageCacheConfig()\n+\tic.TypedSpec().Roots = []string{\"/imagecache\"}\n+\tic.TypedSpec().Status = crires.ImageCacheStatusReady\n+\n+\tsuite.Require().NoError(suite.State().Create(suite.Ctx(), ic))\n+\n+\tctest.AssertResource(suite, crires.RegistriesConfigID, func(r *crires.RegistriesConfig, a *assert.Assertions) {\n+\t\tspec := r.TypedSpec()\n+\n+\t\ta.Equal(\n+\t\t\tmap[string]*crires.RegistryMirrorConfig{\n+\t\t\t\t\"*\": {MirrorEndpoints: []string{\n+\t\t\t\t\t\"http://\" + constants.RegistrydListenAddress,\n+\t\t\t\t}},\n+\t\t\t\t\"docker.io\": {MirrorEndpoints: []string{\n+\t\t\t\t\t\"http://\" + constants.RegistrydListenAddress,\n+\t\t\t\t\t\"https://mirror.io\",\n+\t\t\t\t}},\n+\t\t\t},\n+\t\t\tspec.RegistryMirrors,\n+\t\t)\n+\n+\t\ta.Equal(\n+\t\t\tmap[string]*crires.RegistryConfig{\n+\t\t\t\t\"docker.io\": {\n+\t\t\t\t\tRegistryTLS: &crires.RegistryTLSConfig{\n+\t\t\t\t\t\tTLSInsecureSkipVerify: pointer.To(true),\n+\t\t\t\t\t},\n+\t\t\t\t},\n+\t\t\t},\n+\t\t\tspec.RegistryConfig,\n+\t\t)\n+\t})\n+}\n+\n func (suite *ConfigSuite) TestRegistryNoMachineConfig() {\n \tcfg := config.NewMachineConfig(container.NewV1Alpha1(nil))\n "
    },
    {
      "filename": "internal/app/machined/pkg/controllers/k8s/control_plane.go",
      "status": "modified",
      "patch": "@@ -7,6 +7,7 @@ package k8s\n import (\n \t\"context\"\n \t\"fmt\"\n+\t\"slices\"\n \t\"strconv\"\n \t\"strings\"\n \n@@ -127,20 +128,24 @@ func NewControlPlaneAuthorizationController() *ControlPlaneAuthorizationControll\n \t\t\t\t\treturn nil\n \t\t\t\t}\n \n+\t\t\t\tvar authorizers []k8s.AuthorizationAuthorizersSpec\n+\n \t\t\t\tfor _, authorizer := range cfgProvider.Cluster().APIServer().AuthorizationConfig() {\n \t\t\t\t\t// skip Node and RBAC authorizers as we add them by default later on.\n \t\t\t\t\tif authorizer.Type() == \"Node\" || authorizer.Type() == \"RBAC\" {\n \t\t\t\t\t\tcontinue\n \t\t\t\t\t}\n \n-\t\t\t\t\tres.TypedSpec().Config = append(res.TypedSpec().Config, k8s.AuthorizationAuthorizersSpec{\n-\t\t\t\t\t\tType:    authorizer.Type(),\n-\t\t\t\t\t\tName:    authorizer.Name(),\n-\t\t\t\t\t\tWebhook: authorizer.Webhook(),\n+\t\t\t\t\tauthorizers = slices.Concat(authorizers, []k8s.AuthorizationAuthorizersSpec{\n+\t\t\t\t\t\t{\n+\t\t\t\t\t\t\tType:    authorizer.Type(),\n+\t\t\t\t\t\t\tName:    authorizer.Name(),\n+\t\t\t\t\t\t\tWebhook: authorizer.Webhook(),\n+\t\t\t\t\t\t},\n \t\t\t\t\t})\n \t\t\t\t}\n \n-\t\t\t\tres.TypedSpec().Config = append(v1alpha1.APIServerDefaultAuthorizationConfigAuthorizers, res.TypedSpec().Config...)\n+\t\t\t\tres.TypedSpec().Config = slices.Concat(v1alpha1.APIServerDefaultAuthorizationConfigAuthorizers, authorizers)\n \n \t\t\t\treturn nil\n \t\t\t},"
    },
    {
      "filename": "internal/app/machined/pkg/controllers/k8s/control_plane_test.go",
      "status": "modified",
      "patch": "@@ -6,6 +6,7 @@ package k8s_test\n \n import (\n \t\"net/url\"\n+\t\"slices\"\n \t\"strings\"\n \t\"testing\"\n \t\"time\"\n@@ -208,16 +209,18 @@ func (suite *K8sControlPlaneSuite) TestReconcileAdditionalAuthorizationConfigAut\n \n \tsuite.setupMachine(cfg)\n \n-\texpectedAuthorizers := append(v1alpha1.APIServerDefaultAuthorizationConfigAuthorizers, k8s.AuthorizationAuthorizersSpec{ //nolint:gocritic\n-\t\tType: \"Webhook\",\n-\t\tName: \"webhook\",\n-\t\tWebhook: map[string]any{\n-\t\t\t\"timeout\":                    \"3s\",\n-\t\t\t\"subjectAccessReviewVersion\": \"v1\",\n-\t\t\t\"matchConditionSubjectAccessReviewVersion\": \"v1\",\n-\t\t\t\"failurePolicy\": \"NoOpinion\",\n-\t\t\t\"connectionInfo\": map[string]any{\n-\t\t\t\t\"type\": \"InClusterConfig\",\n+\texpectedAuthorizers := slices.Concat(v1alpha1.APIServerDefaultAuthorizationConfigAuthorizers, []k8s.AuthorizationAuthorizersSpec{\n+\t\t{\n+\t\t\tType: \"Webhook\",\n+\t\t\tName: \"webhook\",\n+\t\t\tWebhook: map[string]any{\n+\t\t\t\t\"timeout\":                    \"3s\",\n+\t\t\t\t\"subjectAccessReviewVersion\": \"v1\",\n+\t\t\t\t\"matchConditionSubjectAccessReviewVersion\": \"v1\",\n+\t\t\t\t\"failurePolicy\": \"NoOpinion\",\n+\t\t\t\t\"connectionInfo\": map[string]any{\n+\t\t\t\t\t\"type\": \"InClusterConfig\",\n+\t\t\t\t},\n \t\t\t},\n \t\t},\n \t})\n@@ -280,16 +283,18 @@ func (suite *K8sControlPlaneSuite) TestReconcileAdditionalAuthorizationConfigAut\n \n \tsuite.setupMachine(cfg)\n \n-\texpectedAuthorizers := append(v1alpha1.APIServerDefaultAuthorizationConfigAuthorizers, k8s.AuthorizationAuthorizersSpec{ //nolint:gocritic\n-\t\tType: \"Webhook\",\n-\t\tName: \"webhook\",\n-\t\tWebhook: map[string]any{\n-\t\t\t\"timeout\":                    \"3s\",\n-\t\t\t\"subjectAccessReviewVersion\": \"v1\",\n-\t\t\t\"matchConditionSubjectAccessReviewVersion\": \"v1\",\n-\t\t\t\"failurePolicy\": \"NoOpinion\",\n-\t\t\t\"connectionInfo\": map[string]any{\n-\t\t\t\t\"type\": \"InClusterConfig\",\n+\texpectedAuthorizers := slices.Concat(v1alpha1.APIServerDefaultAuthorizationConfigAuthorizers, []k8s.AuthorizationAuthorizersSpec{\n+\t\t{\n+\t\t\tType: \"Webhook\",\n+\t\t\tName: \"webhook\",\n+\t\t\tWebhook: map[string]any{\n+\t\t\t\t\"timeout\":                    \"3s\",\n+\t\t\t\t\"subjectAccessReviewVersion\": \"v1\",\n+\t\t\t\t\"matchConditionSubjectAccessReviewVersion\": \"v1\",\n+\t\t\t\t\"failurePolicy\": \"NoOpinion\",\n+\t\t\t\t\"connectionInfo\": map[string]any{\n+\t\t\t\t\t\"type\": \"InClusterConfig\",\n+\t\t\t\t},\n \t\t\t},\n \t\t},\n \t})"
    },
    {
      "filename": "internal/app/machined/pkg/controllers/network/address_spec.go",
      "status": "modified",
      "patch": "@@ -11,12 +11,14 @@ import (\n \t\"net\"\n \t\"net/netip\"\n \t\"os\"\n+\t\"slices\"\n \n \t\"github.com/cosi-project/runtime/pkg/controller\"\n \t\"github.com/cosi-project/runtime/pkg/resource\"\n \t\"github.com/cosi-project/runtime/pkg/safe\"\n \t\"github.com/jsimonetti/rtnetlink/v2\"\n \t\"github.com/mdlayher/arp\"\n+\t\"github.com/siderolabs/go-pointer\"\n \t\"go.uber.org/zap\"\n \t\"go4.org/netipx\"\n \t\"golang.org/x/sys/unix\"\n@@ -117,12 +119,28 @@ func (ctrl *AddressSpecController) Run(ctx context.Context, r controller.Runtime\n }\n \n func resolveLinkName(links []rtnetlink.LinkMessage, linkName string) uint32 {\n+\tif linkName == \"\" {\n+\t\treturn 0 // should never match\n+\t}\n+\n+\t// first, lookup by name\n \tfor _, link := range links {\n \t\tif link.Attributes.Name == linkName {\n \t\t\treturn link.Index\n \t\t}\n \t}\n \n+\t// then, lookup by alias/altname\n+\tfor _, link := range links {\n+\t\tif pointer.SafeDeref(link.Attributes.Alias) == linkName {\n+\t\t\treturn link.Index\n+\t\t}\n+\n+\t\tif slices.Index(link.Attributes.AltNames, linkName) != -1 {\n+\t\t\treturn link.Index\n+\t\t}\n+\t}\n+\n \treturn 0\n }\n "
    },
    {
      "filename": "internal/app/machined/pkg/controllers/network/address_spec_test.go",
      "status": "modified",
      "patch": "@@ -238,6 +238,74 @@ func (suite *AddressSpecSuite) TestDummy() {\n \t}\n }\n \n+func (suite *AddressSpecSuite) TestDummyAlias() {\n+\tdummyInterface := suite.uniqueDummyInterface()\n+\tdummyAlias := suite.uniqueDummyInterface()\n+\n+\tsuite.T().Logf(\"dummyInterface: %s, dummyAlias: %s\", dummyInterface, dummyAlias)\n+\n+\tconn, err := rtnetlink.Dial(nil)\n+\tsuite.Require().NoError(err)\n+\n+\tdefer conn.Close() //nolint:errcheck\n+\n+\tdummy := network.NewAddressSpec(network.NamespaceName, \"dummy/10.0.0.5/8\")\n+\t*dummy.TypedSpec() = network.AddressSpecSpec{\n+\t\tAddress:     netip.MustParsePrefix(\"10.0.0.5/8\"),\n+\t\tLinkName:    dummyAlias, // use alias name instead of the actual interface name\n+\t\tFamily:      nethelpers.FamilyInet4,\n+\t\tScope:       nethelpers.ScopeGlobal,\n+\t\tConfigLayer: network.ConfigDefault,\n+\t\tFlags:       nethelpers.AddressFlags(nethelpers.AddressPermanent),\n+\t}\n+\n+\t// it's fine to create the address before the interface is actually created\n+\tfor _, res := range []resource.Resource{dummy} {\n+\t\tsuite.Require().NoError(suite.state.Create(suite.ctx, res), \"%v\", res.Spec())\n+\t}\n+\n+\t// create dummy interface\n+\tsuite.Require().NoError(\n+\t\tconn.Link.New(\n+\t\t\t&rtnetlink.LinkMessage{\n+\t\t\t\tType: unix.ARPHRD_ETHER,\n+\t\t\t\tAttributes: &rtnetlink.LinkAttributes{\n+\t\t\t\t\tName: dummyInterface,\n+\t\t\t\t\tMTU:  1400,\n+\t\t\t\t\tInfo: &rtnetlink.LinkInfo{\n+\t\t\t\t\t\tKind: \"dummy\",\n+\t\t\t\t\t},\n+\t\t\t\t},\n+\t\t\t},\n+\t\t),\n+\t)\n+\n+\tiface, err := net.InterfaceByName(dummyInterface)\n+\tsuite.Require().NoError(err)\n+\n+\t// set alias name\n+\tsuite.Require().NoError(\n+\t\tconn.Link.Set(\n+\t\t\t&rtnetlink.LinkMessage{\n+\t\t\t\tIndex: uint32(iface.Index),\n+\t\t\t\tAttributes: &rtnetlink.LinkAttributes{\n+\t\t\t\t\tAlias: &dummyAlias,\n+\t\t\t\t},\n+\t\t\t},\n+\t\t),\n+\t)\n+\n+\tdefer conn.Link.Delete(uint32(iface.Index)) //nolint:errcheck\n+\n+\tsuite.Assert().NoError(\n+\t\tretry.Constant(3*time.Second, retry.WithUnits(100*time.Millisecond)).Retry(\n+\t\t\tfunc() error {\n+\t\t\t\treturn suite.assertLinkAddress(dummyInterface, \"10.0.0.5/8\")\n+\t\t\t},\n+\t\t),\n+\t)\n+}\n+\n func (suite *AddressSpecSuite) TearDownTest() {\n \tsuite.T().Log(\"tear down\")\n "
    },
    {
      "filename": "internal/app/machined/pkg/controllers/network/link_config.go",
      "status": "modified",
      "patch": "@@ -183,27 +183,42 @@ func (ctrl *LinkConfigController) Run(ctx context.Context, r controller.Runtime,\n \t\t\treturn fmt.Errorf(\"error listing link statuses: %w\", err)\n \t\t}\n \n+\touter:\n \t\tfor _, item := range list.Items {\n \t\t\tlinkStatus := item.(*network.LinkStatus) //nolint:forcetypeassert\n \n-\t\t\tif _, configured := configuredLinks[linkStatus.Metadata().ID()]; !configured {\n-\t\t\t\tif linkStatus.TypedSpec().Physical() {\n-\t\t\t\t\tvar ids []string\n+\t\t\tif _, configured := configuredLinks[linkStatus.Metadata().ID()]; configured {\n+\t\t\t\tcontinue\n+\t\t\t}\n \n-\t\t\t\t\tids, err = ctrl.apply(ctx, r, []network.LinkSpecSpec{\n-\t\t\t\t\t\t{\n-\t\t\t\t\t\t\tName:        linkStatus.Metadata().ID(),\n-\t\t\t\t\t\t\tUp:          true,\n-\t\t\t\t\t\t\tConfigLayer: network.ConfigDefault,\n-\t\t\t\t\t\t},\n-\t\t\t\t\t})\n-\t\t\t\t\tif err != nil {\n-\t\t\t\t\t\treturn fmt.Errorf(\"error applying default link up: %w\", err)\n-\t\t\t\t\t}\n+\t\t\tif linkStatus.TypedSpec().Alias != \"\" {\n+\t\t\t\tif _, configured := configuredLinks[linkStatus.TypedSpec().Alias]; configured {\n+\t\t\t\t\tcontinue\n+\t\t\t\t}\n+\t\t\t}\n \n-\t\t\t\t\tfor _, id := range ids {\n-\t\t\t\t\t\ttouchedIDs[id] = struct{}{}\n-\t\t\t\t\t}\n+\t\t\tfor _, altName := range linkStatus.TypedSpec().AltNames {\n+\t\t\t\tif _, configured := configuredLinks[altName]; configured {\n+\t\t\t\t\tcontinue outer\n+\t\t\t\t}\n+\t\t\t}\n+\n+\t\t\tif linkStatus.TypedSpec().Physical() {\n+\t\t\t\tvar ids []string\n+\n+\t\t\t\tids, err = ctrl.apply(ctx, r, []network.LinkSpecSpec{\n+\t\t\t\t\t{\n+\t\t\t\t\t\tName:        linkStatus.Metadata().ID(),\n+\t\t\t\t\t\tUp:          true,\n+\t\t\t\t\t\tConfigLayer: network.ConfigDefault,\n+\t\t\t\t\t},\n+\t\t\t\t})\n+\t\t\t\tif err != nil {\n+\t\t\t\t\treturn fmt.Errorf(\"error applying default link up: %w\", err)\n+\t\t\t\t}\n+\n+\t\t\t\tfor _, id := range ids {\n+\t\t\t\t\ttouchedIDs[id] = struct{}{}\n \t\t\t\t}\n \t\t\t}\n \t\t}"
    }
  ],
  "fix_category": "Other",
  "root_cause_category": "Unordered collections",
  "root_cause_subcategory": NaN
}