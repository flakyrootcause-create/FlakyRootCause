{
  "id": 388,
  "repo": "django",
  "issue_url": "https://github.com/django/django/pull/19267",
  "pr_url": "https://github.com/django/django/pull/19267",
  "issue_description": "My theory is that since 0ebea6e5c07485a36862e9b6e2be18d1694ad2c5, the saving of objects has become slightly slower\r\nThis caused some failures in the selenium test suite: https://github.com/django/django/actions/runs/13826117388/job/38698352291\r\n",
  "files_changed": [
    {
      "filename": "django/contrib/admin/tests.py",
      "status": "modified",
      "patch": "@@ -123,13 +123,21 @@ def wait_page_loaded(self, timeout=10):\n         \"\"\"\n         Block until a new page has loaded and is ready.\n         \"\"\"\n+        from selenium.common.exceptions import WebDriverException\n         from selenium.webdriver.common.by import By\n         from selenium.webdriver.support import expected_conditions as ec\n \n         old_page = self.selenium.find_element(By.TAG_NAME, \"html\")\n         yield\n         # Wait for the next page to be loaded\n-        self.wait_until(ec.staleness_of(old_page), timeout=timeout)\n+        try:\n+            self.wait_until(ec.staleness_of(old_page), timeout=timeout)\n+        except WebDriverException:\n+            # Issue in version 113+ of Chrome driver where a WebDriverException\n+            # error is raised rather than a StaleElementReferenceException, see:\n+            # https://issues.chromium.org/issues/42323468\n+            pass\n+\n         self.wait_page_ready(timeout=timeout)\n \n     def admin_login(self, username, password, login_url=\"/admin/\"):"
    },
    {
      "filename": "tests/admin_views/tests.py",
      "status": "modified",
      "patch": "@@ -6448,6 +6448,7 @@ def test_inline_uuid_pk_delete_with_popup(self):\n         ActionChains(self.selenium).move_to_element(delete_parent).click().perform()\n         self.wait_for_and_switch_to_popup()\n         self.selenium.find_element(By.XPATH, '//input[@value=\"Yes, I\u2019m sure\"]').click()\n+        self.wait_until(lambda d: len(d.window_handles) == 1, 1)\n         self.selenium.switch_to.window(self.selenium.window_handles[0])\n         select = Select(self.selenium.find_element(By.ID, \"id_parent\"))\n         self.assertEqual(ParentWithUUIDPK.objects.count(), 0)\n@@ -6582,6 +6583,7 @@ def test_related_popup_index(self):\n \n         self.selenium.find_element(By.ID, \"id_title\").send_keys(\"test3\")\n         self.selenium.find_element(By.XPATH, '//input[@value=\"Save\"]').click()\n+        self.wait_until(lambda d: len(d.window_handles) == 3, 1)\n         self.selenium.switch_to.window(popup_window_test2)\n         select = Select(self.selenium.find_element(By.ID, \"id_next_box\"))\n         next_box_id = str(Box.objects.get(title=\"test3\").id)\n@@ -6590,6 +6592,7 @@ def test_related_popup_index(self):\n         )\n \n         self.selenium.find_element(By.XPATH, '//input[@value=\"Save\"]').click()\n+        self.wait_until(lambda d: len(d.window_handles) == 2, 1)\n         self.selenium.switch_to.window(popup_window_test)\n         select = Select(self.selenium.find_element(By.ID, \"id_next_box\"))\n         next_box_id = str(Box.objects.get(title=\"test2\").id)\n@@ -6598,6 +6601,7 @@ def test_related_popup_index(self):\n         )\n \n         self.selenium.find_element(By.XPATH, '//input[@value=\"Save\"]').click()\n+        self.wait_until(lambda d: len(d.window_handles) == 1, 1)\n         self.selenium.switch_to.window(base_window)\n         select = Select(self.selenium.find_element(By.ID, \"id_next_box\"))\n         next_box_id = str(Box.objects.get(title=\"test\").id)\n@@ -6833,15 +6837,17 @@ def test_redirect_on_add_view_add_another_button(self):\n         self.selenium.get(self.live_server_url + add_url)\n         name_input = self.selenium.find_element(By.ID, \"id_name\")\n         name_input.send_keys(\"Test section 1\")\n-        self.selenium.find_element(\n-            By.XPATH, '//input[@value=\"Save and add another\"]'\n-        ).click()\n+        with self.wait_page_loaded():\n+            self.selenium.find_element(\n+                By.XPATH, '//input[@value=\"Save and add another\"]'\n+            ).click()\n         self.assertEqual(Section.objects.count(), 1)\n         name_input = self.selenium.find_element(By.ID, \"id_name\")\n         name_input.send_keys(\"Test section 2\")\n-        self.selenium.find_element(\n-            By.XPATH, '//input[@value=\"Save and add another\"]'\n-        ).click()\n+        with self.wait_page_loaded():\n+            self.selenium.find_element(\n+                By.XPATH, '//input[@value=\"Save and add another\"]'\n+            ).click()\n         self.assertEqual(Section.objects.count(), 2)\n \n     def test_redirect_on_add_view_continue_button(self):\n@@ -6854,9 +6860,10 @@ def test_redirect_on_add_view_continue_button(self):\n         self.selenium.get(self.live_server_url + add_url)\n         name_input = self.selenium.find_element(By.ID, \"id_name\")\n         name_input.send_keys(\"Test section 1\")\n-        self.selenium.find_element(\n-            By.XPATH, '//input[@value=\"Save and continue editing\"]'\n-        ).click()\n+        with self.wait_page_loaded():\n+            self.selenium.find_element(\n+                By.XPATH, '//input[@value=\"Save and continue editing\"]'\n+            ).click()\n         self.assertEqual(Section.objects.count(), 1)\n         name_input = self.selenium.find_element(By.ID, \"id_name\")\n         name_input_value = name_input.get_attribute(\"value\")"
    },
    {
      "filename": "tests/forms_tests/tests/test_widgets.py",
      "status": "modified",
      "patch": "@@ -19,6 +19,7 @@ def test_textarea_trailing_newlines(self):\n         self.selenium.get(\n             self.live_server_url + reverse(\"article_form\", args=[article.pk])\n         )\n-        self.selenium.find_element(By.ID, \"submit\").click()\n+        with self.wait_page_loaded():\n+            self.selenium.find_element(By.ID, \"submit\").click()\n         article = Article.objects.get(pk=article.pk)\n         self.assertEqual(article.content, \"\\r\\nTst\\r\\n\")"
    }
  ],
  "fix_category": "Other",
  "root_cause_category": "Async wait",
  "root_cause_subcategory": NaN
}