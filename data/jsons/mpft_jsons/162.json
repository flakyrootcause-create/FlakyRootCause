{
  "id": 162,
  "repo": "jedis",
  "issue_url": "https://github.com/redis/jedis/pull/3617",
  "pr_url": "https://github.com/redis/jedis/pull/3617",
  "issue_description": "## Description\r\nThere are 2 tests in the `DocumentTest.java` class which call the `DocumentTest.toString` method, this method converts a `Map` object to a string, which is not in any particular order, the tests may pass or fail even though the code under test may be working as expected.\r\nhttps://github.com/219sansim/jedis/blob/c1cc657e8b3a984aab8779f84aa0ff55c2b29118/src/main/java/redis/clients/jedis/search/Document.java#L23\r\nTo resolve the bug, I changed the code to check for both possible orderings. \r\n\r\nAnother possible fix could be to check if the string contains both the fields.\r\n\r\n## Reproduction of error\r\nRun maven tests with [NonDex](https://github.com/TestingResearchIllinois/NonDex) tool\r\n```\r\nmvn edu.illinois:nondex-maven-plugin:2.1.1:nondex -Dtest=redis.clients.jedis.modules.search.DocumentTest#toStringTest\r\nmvn edu.illinois:nondex-maven-plugin:2.1.1:nondex -Dtest=redis.clients.jedis.modules.search.DocumentTest#serialize\r\n```\r\n**Error Output**\r\nShowing error output of test `serialize`\r\n```\r\n[ERROR] Failures: \r\n[ERROR]   DocumentTest.serialize:45 expected:<...: 10.0, properties:[[string=c, float=12.0]]> but was:<...: 10.0, properties:[[float=12.0, string=c]]>\r\n```\r\nAfter making the changes, the tests pass with [NonDex](https://github.com/TestingResearchIllinois/NonDex) tool \r\n",
  "files_changed": [
    {
      "filename": "src/test/java/redis/clients/jedis/modules/search/DocumentTest.java",
      "status": "modified",
      "patch": "@@ -13,6 +13,7 @@\n import redis.clients.jedis.search.Document;\n \n import static org.junit.jupiter.api.Assertions.assertEquals;\n+import static org.junit.jupiter.api.Assertions.assertTrue;\n \n public class DocumentTest {\n \n@@ -38,13 +39,8 @@ public void serialize() throws IOException, ClassNotFoundException {\n \n     assertEquals(id, read.getId());\n     assertEquals(score, read.getScore(), 0d);\n-\n-    // use english language to make sure the decimal separator is the same as the toString\n-    String exp = String.format(Locale.ENGLISH, \"id:%s, score: %.1f, properties:%s\",\n-        id, score, \"[string=c, float=12.0]\");\n-    assertEquals(exp, read.toString());\n     assertEquals(\"c\", read.getString(\"string\"));\n-    assertEquals(Double.valueOf(12d), read.get(\"float\"));\n+    assertEquals(12d, read.get(\"float\"));\n   }\n \n   @Test\n@@ -57,8 +53,14 @@ public void toStringTest() {\n     Document document = new Document(id, map, score);\n \n     // use english language to make sure the decimal separator is the same as the toString\n-    String expected = String.format(Locale.ENGLISH, \"id:%s, score: %.1f, properties:%s\",\n-        id, score, \"[string=c, float=12.0]\");\n-    assertEquals(expected, document.toString());\n+    String expected1 = String.format(Locale.ENGLISH, \"id:%s, score: %.1f, properties:%s\", id, score,\n+        \"[string=c, float=12.0]\");\n+    String expected2 = String.format(Locale.ENGLISH, \"id:%s, score: %.1f, properties:%s\", id, score,\n+        \"[float=12.0, string=c]\");\n+\n+    // the order of the properties is not guaranteed, so we check both possible outcomes\n+    String actual = document.toString();\n+    assertTrue(actual.equals(expected1) || actual.equals(expected2));\n   }\n+\n }"
    }
  ],
  "fix_category": "Change assertion",
  "root_cause_category": "Unordered collections",
  "root_cause_subcategory": NaN
}