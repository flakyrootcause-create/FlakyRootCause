{
  "id": 253,
  "repo": "django",
  "issue_url": "https://github.com/django/django/pull/16419",
  "pr_url": "https://github.com/django/django/pull/16419",
  "issue_description": "ticket-23842",
  "files_changed": [
    {
      "filename": "tests/gis_tests/geoapp/tests.py",
      "status": "modified",
      "patch": "@@ -645,18 +645,16 @@ def test_make_line(self):\n         self.assertIsNone(State.objects.aggregate(MakeLine(\"poly\"))[\"poly__makeline\"])\n         # Reference query:\n         # SELECT AsText(ST_MakeLine(geoapp_city.point)) FROM geoapp_city;\n-        ref_line = GEOSGeometry(\n-            \"LINESTRING(-95.363151 29.763374,-96.801611 32.782057,\"\n-            \"-97.521157 34.464642,174.783117 -41.315268,-104.609252 38.255001,\"\n-            \"-95.23506 38.971823,-87.650175 41.850385,-123.305196 48.462611)\",\n-            srid=4326,\n-        )\n-        # We check for equality with a tolerance of 10e-5 which is a lower bound\n-        # of the precisions of ref_line coordinates\n         line = City.objects.aggregate(MakeLine(\"point\"))[\"point__makeline\"]\n-        self.assertTrue(\n-            ref_line.equals_exact(line, tolerance=10e-5), \"%s != %s\" % (ref_line, line)\n-        )\n+        ref_points = City.objects.values_list(\"point\", flat=True)\n+        self.assertIsInstance(line, LineString)\n+        self.assertEqual(len(line), ref_points.count())\n+        # Compare pairs of manually sorted points, as the default ordering is\n+        # flaky.\n+        for (point, ref_city) in zip(sorted(line), sorted(ref_points)):\n+            point_x, point_y = point\n+            self.assertAlmostEqual(point_x, ref_city.x, 5),\n+            self.assertAlmostEqual(point_y, ref_city.y, 5),\n \n     @skipUnlessDBFeature(\"supports_union_aggr\")\n     def test_unionagg(self):"
    }
  ],
  "fix_category": "Make deterministic",
  "root_cause_category": "Unordered collections",
  "root_cause_subcategory": NaN
}